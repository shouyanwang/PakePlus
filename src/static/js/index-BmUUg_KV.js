import{s as V,q as w,_ as ve,d as ge,u as ye,r as m,w as he,e as c,D as Y,c as _,o as n,h as t,A as p,E as A,i as l,j as r,F as f,v as x,B as be,t as b,f as Z}from"./index-v815L3Uz.js";import ee from"./Title-tiw_cpls.js";import{g as D}from"./healthSet-De_ekgup.js";import{u as Ve}from"./elder-BWoNrMDq.js";function we(s={}){return V({url:"/bms/v1/elder_health",method:"POST",data:w(s)})}function ke(s={}){return V({url:"/bms/v1/elder_health",method:"GET",params:w(s)})}function Ce(s={}){return V({url:"/bms/v1/medication",method:"POST",data:w(s)})}function xe(s={}){return V({url:"/bms/v1/medication",method:"GET",params:w(s)})}function Ee(s={}){return V({url:`/bms/v1/medication/${s.id}`,method:"GET",params:w(s)})}function qe(s={}){return V({url:`/bms/v1/medication/${s.id}`,method:"PATCH",data:w(s)})}function Ae(s={}){return V({url:`/bms/v1/medication/${s.id}`,method:"DELETE",data:w(s)})}const De={class:"dialog-footer"},Se={key:0,class:"tag"},Te={class:"dialog-footer"},Ue={__name:"index",setup(s){const{proxy:v}=ge();ye();const g=Ve(),S=m([]),H=async()=>{const o=await ke({elder_id:g.elder.id});S.value=o.data},k=m([]),P=async()=>{const o=await D({type:1});k.value=o.data,k.value.push({id:"-99",name:"其他（请补充）"})};P();const E=m(!1),ae=async()=>{await P(),S.value.forEach(o=>{if(o.health_set_id==0){const a=k.value.find(i=>i.id=="-99");console.log(a),a.selected=!0,a.value=o.other}else k.value.find(a=>a.id==o.health_set_id).selected=!0}),E.value=!0},le=()=>{E.value=!1},te=async()=>{const o=k.value.filter(a=>a.selected).map(a=>a.id==="-99"?{type:2,value:a.value}:{type:1,value:a.id});await we({elder_id:g.elder.id,health:o}),v.$modal.msgSuccess("编辑成功"),E.value=!1,H()},oe=()=>({backgroundColor:"#F6F8FF",color:"#C5C5C5"}),F=m(!1),O=m([]),T=async()=>{F.value=!0;const o=await xe({elder_id:g.elder.id});O.value=o.data,F.value=!1};he(()=>g.elder,o=>{o.id&&(H(),T())},{immediate:!0});const ne=m(null),d=m({no:"",medicine:"",usage_method:"",dosage:"",frequency:""}),de={no:[{required:!0,message:"请输入序号",trigger:"blur"}],medicine:[{required:!0,message:"请选择药品名称",trigger:"change"}],usage_method:[{required:!0,message:"请选择用法",trigger:"change"}],dosage:[{required:!0,message:"请选择剂量",trigger:"change"}],frequency:[{required:!0,message:"请选择频次",trigger:"change"}]},B=()=>{Object.keys(d.value).forEach(o=>{d.value[o]=""}),v.resetForm("formRef")},y=m(!1),R=m([]),N=async()=>{const o=await D({type:2});R.value=o.data},j=m([]),G=async()=>{const o=await D({type:3});j.value=o.data},I=m([]),z=async()=>{const o=await D({type:4});I.value=o.data},W=m([]),J=async()=>{const o=await D({type:5});W.value=o.data},se=async()=>{if(!g.elder.id){v.$modal.msgWarning("请选择长者");return}await B(),await N(),await G(),await z(),await J(),y.value=!0},ue=async o=>{await B(),await N(),await G(),await z(),await J();const a=await Ee({id:o.id});Object.keys(d.value).forEach(i=>{d.value[i]=a.data[i]}),d.value.id=o.id,y.value=!0},re=()=>{y.value=!1},ie=()=>{v.$refs.formRef.validate(async o=>{o&&(d.value.id!=""?(await qe({elder_id:g.elder.id,...d.value}),v.$modal.msgSuccess("编辑成功"),y.value=!1,T()):(await Ce({elder_id:g.elder.id,...d.value}),v.$modal.msgSuccess("添加成功"),y.value=!1,T()))})},ce=async o=>{v.$modal.confirm("是否确认删除?").then(async()=>{await Ae({id:o.id}),v.$modal.msgSuccess("删除成功"),T()}).catch(()=>{})};return(o,a)=>{const i=c("el-button"),K=c("el-input"),me=c("el-checkbox"),h=c("el-col"),U=c("el-row"),Q=c("el-form"),X=c("Dialog"),pe=c("el-empty"),q=c("el-form-item"),$=c("el-option"),L=c("el-select"),C=c("el-table-column"),_e=c("el-table"),M=Y("hasPermi"),fe=Y("loading");return n(),_(f,null,[t(ee,{title:"疾病诊断"},{right:l(()=>[A((n(),p(i,{icon:"edit",type:"primary",onClick:ae},{default:l(()=>a[7]||(a[7]=[r("编辑")])),_:1,__:[7]})),[[M,["POST.elder_health"]]])]),_:1}),t(X,{modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),title:"编辑疾病诊断（可多选）"},{footer:l(()=>[Z("div",De,[t(i,{onClick:le},{default:l(()=>a[8]||(a[8]=[r("取消")])),_:1,__:[8]}),t(i,{type:"primary",onClick:te},{default:l(()=>a[9]||(a[9]=[r(" 保存 ")])),_:1,__:[9]})])]),default:l(()=>[t(Q,{"label-position":"top"},{default:l(()=>[t(U,{gutter:26},{default:l(()=>[(n(!0),_(f,null,x(k.value,e=>(n(),p(h,{span:4,key:e.id},{default:l(()=>[t(me,{modelValue:e.selected,"onUpdate:modelValue":u=>e.selected=u},{default:l(()=>[r(b(e.name)+" ",1),e.id=="-99"?(n(),p(K,{key:0,modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,placeholder:"请填写",style:{width:"240px","margin-left":"10px"}},null,8,["modelValue","onUpdate:modelValue"])):be("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),S.value.length>0?(n(),_("div",Se,[(n(!0),_(f,null,x(S.value,e=>(n(),_("div",{class:"item",key:e.id},[e.health_set_id==0?(n(),_(f,{key:0},[r(b(e.other),1)],64)):(n(),_(f,{key:1},[r(b(e.health_set.name),1)],64))]))),128))])):(n(),p(pe,{key:1,"image-size":30})),t(ee,{title:"用药情况",desc:"（目前长期服药情况）"},{right:l(()=>[A((n(),p(i,{icon:"plus",type:"primary",onClick:se},{default:l(()=>a[10]||(a[10]=[r("添加")])),_:1,__:[10]})),[[M,["POST.medication"]]])]),_:1}),t(X,{modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=e=>y.value=e),title:"添加用药情况",desc:"（目前长期服药情况）"},{footer:l(()=>[Z("div",Te,[t(i,{onClick:re},{default:l(()=>a[11]||(a[11]=[r("取消")])),_:1,__:[11]}),t(i,{type:"primary",onClick:ie},{default:l(()=>a[12]||(a[12]=[r(" 保存 ")])),_:1,__:[12]})])]),default:l(()=>[t(Q,{model:d.value,rules:de,ref_key:"formRef",ref:ne,"label-position":"top"},{default:l(()=>[t(U,{gutter:146},{default:l(()=>[t(h,{span:12},{default:l(()=>[t(q,{label:"序号",prop:"no"},{default:l(()=>[t(K,{modelValue:d.value.no,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value.no=e),type:"number",placeholder:"请输入序号"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{span:12},{default:l(()=>[t(q,{label:"药物名称",prop:"medicine"},{default:l(()=>[t(L,{modelValue:d.value.medicine,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value.medicine=e),placeholder:"请选择药物"},{default:l(()=>[(n(!0),_(f,null,x(R.value,e=>(n(),p($,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(U,{gutter:146},{default:l(()=>[t(h,{span:12},{default:l(()=>[t(q,{label:"服药方法",prop:"usage_method"},{default:l(()=>[t(L,{modelValue:d.value.usage_method,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value.usage_method=e),placeholder:"请选择服药方法"},{default:l(()=>[(n(!0),_(f,null,x(j.value,e=>(n(),p($,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(h,{span:12},{default:l(()=>[t(q,{label:"用药剂量",prop:"dosage"},{default:l(()=>[t(L,{modelValue:d.value.dosage,"onUpdate:modelValue":a[4]||(a[4]=e=>d.value.dosage=e),placeholder:"请选择用药剂量"},{default:l(()=>[(n(!0),_(f,null,x(I.value,e=>(n(),p($,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(U,{gutter:146},{default:l(()=>[t(h,{span:12},{default:l(()=>[t(q,{label:"用药频率",prop:"frequency"},{default:l(()=>[t(L,{modelValue:d.value.frequency,"onUpdate:modelValue":a[5]||(a[5]=e=>d.value.frequency=e),placeholder:"请选择用药频率"},{default:l(()=>[(n(!0),_(f,null,x(W.value,e=>(n(),p($,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(h,{span:12})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),A((n(),p(_e,{class:"base-info-table",data:O.value,"header-cell-style":oe},{default:l(()=>[t(C,{prop:"no",label:"序号",align:"center"}),t(C,{prop:"medicine_text",label:"药物名称",align:"center"},{default:l(({row:e})=>{var u;return[r(b((u=e.medicine_text)==null?void 0:u.name),1)]}),_:1}),t(C,{prop:"usage_method_text",label:"服药方法",align:"center"},{default:l(({row:e})=>{var u;return[r(b((u=e.usage_method_text)==null?void 0:u.name),1)]}),_:1}),t(C,{prop:"dosage_text",label:"用药剂量",align:"center"},{default:l(({row:e})=>{var u;return[r(b((u=e.dosage_text)==null?void 0:u.name),1)]}),_:1}),t(C,{prop:"frequency_text",label:"用药频率",align:"center"},{default:l(({row:e})=>{var u;return[r(b((u=e.frequency_text)==null?void 0:u.name),1)]}),_:1}),t(C,{prop:"action",label:"操作",align:"center",width:"160"},{default:l(e=>[A((n(),p(i,{type:"primary",plain:"",onClick:u=>ue(e.row)},{default:l(()=>a[13]||(a[13]=[r("编辑")])),_:2,__:[13]},1032,["onClick"])),[[M,["PATCH.medication/{medication}"]]]),A((n(),p(i,{type:"danger",plain:"",onClick:u=>ce(e.row)},{default:l(()=>a[14]||(a[14]=[r("删除")])),_:2,__:[14]},1032,["onClick"])),[[M,["DELETE.medication/{medication}"]]])]),_:1})]),_:1},8,["data"])),[[fe,F.value]])],64)}}},He=ve(Ue,[["__scopeId","data-v-7ab87ff5"]]);export{He as default};
