import{_ as re,d as de,u as ie,r as m,w as pe,M as me,e as r,D as H,c as V,o as d,f as h,h as e,E as x,i as l,A as y,j as _,F as U,v as j,t as A}from"./index-v815L3Uz.js";import{a as _e,p as G,b as ve,c as M,d as ge}from"./user-DPlKwX_g.js";import{g as fe}from"./roles-DdkGosk-.js";import{g as ce}from"./epartmene-DO2Lc-6I.js";const be={class:"search-form"},Ve={class:"dialog-footer"},ye={__name:"index",setup(we){const{proxy:f}=de(),z=ie(),i=m({keyword:"",epartmene_id:"",page:1,per_page:10}),D=m(!1),T=m(0),$=m([]),J=()=>({backgroundColor:"#F6F8FF",color:"#C5C5C5"}),c=async()=>{D.value=!0;const s=await _e(i.value);D.value=!1,$.value=s.data.data,T.value=s.data.total};c();const K=()=>{i.value.page=1,c()};pe(()=>z.query,s=>{s.type=="add"?me(()=>{B()}):(i.value.epartmene_id=s.id,c())},{immediate:!0});const Q=m(null),o=m({user_name:"",password:"",avatar:"",mobile:"",name:"",sex:"",epartmene_ids:"",role_ids:"",status:""}),W=m({avatar:[{required:!0,message:"请上传头像",trigger:"change"}],user_name:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],role_ids:[{required:!0,message:"请选择角色",trigger:"change"}],epartmene_ids:[{required:!0,message:"请选择科室",trigger:"change"}]}),L=m([]);(async()=>{const s=await fe();L.value=s.data})();const N=m([]);(async()=>{const s=await ce();N.value=s.data})();const b=m(!1),R=m(""),F=()=>{o.value.id="",Object.keys(o.value).forEach(s=>{o.value[s]=""}),o.value.sex=1,o.value.status=1,f.resetForm("formRef")},B=()=>{F(),R.value="新增用户",b.value=!0},X=async s=>{F();const a=await M({id:s.id});b.value=!0,R.value="修改用户",Object.keys(o.value).forEach(u=>{o.value[u]=a.data[u]}),o.value.id=s.id,o.value.role_ids=a.data.roles.map(u=>u.role_id),o.value.epartmene_ids=a.data.epartmene_ids.split(",").map(u=>Number(u))},Y=async(s,a)=>{const u=await M({id:a.id});Object.keys(o.value).forEach(n=>{o.value[n]=u.data[n]}),o.value.id=a.id,o.value.role_ids=u.data.roles.map(n=>n.role_id).join(","),o.value.epartmene_ids=u.data.epartmene_ids.split(",").map(n=>Number(n)).join(","),await G({...o.value,status:s}),f.$modal.msgSuccess("修改成功")},Z=()=>{b.value=!1,F()},ee=()=>{f.$refs.formRef.validate(async s=>{s&&(o.value.id!=""?(await G({...o.value,role_ids:o.value.role_ids.join(","),epartmene_ids:o.value.epartmene_ids.join(",")}),f.$modal.msgSuccess("修改成功"),b.value=!1,c()):(await ve({...o.value,role_ids:o.value.role_ids.join(","),epartmene_ids:o.value.epartmene_ids.join(",")}),f.$modal.msgSuccess("新增成功"),b.value=!1,c()))})},ae=s=>{f.$modal.confirm("是否确认删除用户?").then(async()=>{await ge({id:s.id}),f.$modal.msgSuccess("删除成功"),c()}).catch(()=>{})};return(s,a)=>{const u=r("el-input"),n=r("el-form-item"),p=r("el-col"),S=r("el-option"),P=r("el-select"),w=r("el-button"),k=r("el-row"),I=r("el-form"),le=r("ImageUpload"),q=r("el-radio"),O=r("el-radio-group"),te=r("Dialog"),v=r("el-table-column"),oe=r("el-switch"),se=r("el-table"),ne=r("Pagination"),E=H("hasPermi"),ue=H("loading");return d(),V(U,null,[h("div",be,[e(I,{model:i.value,ref:"queryRef"},{default:l(()=>[e(k,{gutter:30},{default:l(()=>[e(p,{span:8},{default:l(()=>[e(n,{label:"用户",prop:"keywore"},{default:l(()=>[e(u,{modelValue:i.value.keywore,"onUpdate:modelValue":a[0]||(a[0]=t=>i.value.keywore=t),placeholder:"请输入姓名或用户名搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:l(()=>[e(n,{label:"状态",prop:"status"},{default:l(()=>[e(P,{modelValue:i.value.status,"onUpdate:modelValue":a[1]||(a[1]=t=>i.value.status=t),placeholder:"请选择状态",clearable:""},{default:l(()=>[e(S,{label:"正常",value:1}),e(S,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:l(()=>[e(n,null,{default:l(()=>[x((d(),y(w,{type:"primary",icon:"Search",onClick:K},{default:l(()=>a[14]||(a[14]=[_("查询")])),_:1,__:[14]})),[[E,["GET.site_admin"]]]),x((d(),y(w,{icon:"plus",type:"primary",onClick:B},{default:l(()=>a[15]||(a[15]=[_("新增用户")])),_:1,__:[15]})),[[E,["POST.site_admin"]]])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),e(te,{modelValue:b.value,"onUpdate:modelValue":a[11]||(a[11]=t=>b.value=t),title:R.value,width:"936"},{footer:l(()=>[h("div",Ve,[e(w,{onClick:Z},{default:l(()=>a[20]||(a[20]=[_("取消")])),_:1,__:[20]}),e(w,{type:"primary",onClick:ee},{default:l(()=>a[21]||(a[21]=[_(" 确认 ")])),_:1,__:[21]})])]),default:l(()=>[e(I,{model:o.value,rules:W.value,ref_key:"formRef",ref:Q,"label-position":"top"},{default:l(()=>[e(k,{gutter:52},{default:l(()=>[e(p,{span:12},{default:l(()=>[e(n,{label:"头像",prop:"avatar"},{default:l(()=>[e(le,{modelValue:o.value.avatar,"onUpdate:modelValue":a[2]||(a[2]=t=>o.value.avatar=t),limit:1,isShowTip:!1},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(n,{label:"用户名",prop:"user_name"},{default:l(()=>[e(u,{modelValue:o.value.user_name,"onUpdate:modelValue":a[3]||(a[3]=t=>o.value.user_name=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(n,{label:"密码",prop:"password"},{default:l(()=>[e(u,{modelValue:o.value.password,"onUpdate:modelValue":a[4]||(a[4]=t=>o.value.password=t),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:56},{default:l(()=>[e(p,{span:12},{default:l(()=>[e(n,{label:"姓名",prop:"name"},{default:l(()=>[e(u,{modelValue:o.value.name,"onUpdate:modelValue":a[5]||(a[5]=t=>o.value.name=t),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(n,{label:"电话",prop:"mobile"},{default:l(()=>[e(u,{modelValue:o.value.mobile,"onUpdate:modelValue":a[6]||(a[6]=t=>o.value.mobile=t),placeholder:"请输入电话"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:56},{default:l(()=>[e(p,{span:12},{default:l(()=>[e(n,{label:"性别",prop:"sex"},{default:l(()=>[e(O,{modelValue:o.value.sex,"onUpdate:modelValue":a[7]||(a[7]=t=>o.value.sex=t)},{default:l(()=>[e(q,{value:1},{default:l(()=>a[16]||(a[16]=[_("男")])),_:1,__:[16]}),e(q,{value:2},{default:l(()=>a[17]||(a[17]=[_("女")])),_:1,__:[17]})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(n,{label:"状态",prop:"status"},{default:l(()=>[e(O,{modelValue:o.value.status,"onUpdate:modelValue":a[8]||(a[8]=t=>o.value.status=t)},{default:l(()=>[e(q,{value:1},{default:l(()=>a[18]||(a[18]=[_("正常")])),_:1,__:[18]}),e(q,{value:0},{default:l(()=>a[19]||(a[19]=[_("禁用")])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:56},{default:l(()=>[e(p,{span:12},{default:l(()=>[e(n,{label:"角色",prop:"role_ids"},{default:l(()=>[e(P,{modelValue:o.value.role_ids,"onUpdate:modelValue":a[9]||(a[9]=t=>o.value.role_ids=t),multiple:"","tag-type":"primary","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":4,placeholder:"请选择角色"},{default:l(()=>[(d(!0),V(U,null,j(L.value,t=>(d(),y(S,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(n,{label:"科室",prop:"epartmene_ids"},{default:l(()=>[e(P,{modelValue:o.value.epartmene_ids,"onUpdate:modelValue":a[10]||(a[10]=t=>o.value.epartmene_ids=t),multiple:"","tag-type":"primary","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":4,placeholder:"请选择科室"},{default:l(()=>[(d(!0),V(U,null,j(N.value,t=>(d(),y(S,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),x((d(),y(se,{class:"base-info-table",data:$.value,"header-cell-style":J},{default:l(()=>[e(v,{prop:"user_name",label:"用户名",align:"center"}),e(v,{prop:"name",label:"姓名",align:"center"}),e(v,{prop:"sex",label:"性别",align:"center"},{default:l(({row:t})=>[_(A(s.genderFormat(t.sex)),1)]),_:1}),e(v,{prop:"mobile",label:"电话",align:"center"}),e(v,{prop:"epartmene_text",label:"科室",align:"center"},{default:l(({row:t})=>[(d(!0),V(U,null,j(t.epartmene_text,(g,C)=>(d(),V("span",{key:C},A(g.name)+" "+A(C==t.epartmene_text.length-1?"":"、"),1))),128))]),_:1}),e(v,{prop:"status",label:"状态",align:"center"},{default:l(({row:t})=>[e(oe,{modelValue:t.status,"onUpdate:modelValue":g=>t.status=g,"active-value":1,"inactive-value":0,onChange:g=>Y(g,t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(v,{prop:"role",label:"角色",align:"center"},{default:l(({row:t})=>[(d(!0),V(U,null,j(t.roles,(g,C)=>(d(),V("span",{key:C},A(g.role.name)+" "+A(C==t.roles.length-1?"":"、"),1))),128))]),_:1}),e(v,{prop:"created_at",label:"创建日期",align:"center"}),e(v,{prop:"action",label:"操作",align:"center",width:"160"},{default:l(({row:t})=>[x((d(),y(w,{type:"primary",plain:"",onClick:g=>X(t)},{default:l(()=>a[22]||(a[22]=[_("编辑")])),_:2,__:[22]},1032,["onClick"])),[[E,["PATCH.site_admin/{site_admin}"]]]),x((d(),y(w,{type:"danger",plain:"",onClick:g=>ae(t)},{default:l(()=>a[23]||(a[23]=[_("删除")])),_:2,__:[23]},1032,["onClick"])),[[E,["DELETE.site_admin/{site_admin}"]]])]),_:1})]),_:1},8,["data"])),[[ue,D.value]]),e(ne,{total:T.value,layout:"total, prev, pager, next, jumper",page:i.value.page,"onUpdate:page":a[12]||(a[12]=t=>i.value.page=t),limit:i.value.per_page,"onUpdate:limit":a[13]||(a[13]=t=>i.value.per_page=t),onPagination:c},null,8,["total","page","limit"])],64)}}},qe=re(ye,[["__scopeId","data-v-973a096e"]]);export{qe as default};
