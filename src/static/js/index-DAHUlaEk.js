import{_ as ge,a as be,b as ye,c as we}from"./dashboard_4-C_LFPXOZ.js";import{b as ke,c as Ve,d as Ce,e as De}from"./ass-BHaWqXQG.js";import{_ as xe,d as Ae,r as _,w as Te,e as c,D as ee,c as d,o,E as P,h as s,A as g,i as a,j as i,t as p,B as u,f as l,F as C,v as S,x as Re}from"./index-gubRP18q.js";import{g as Se}from"./baseInfo-Bb6YRiDG.js";import{u as Ue}from"./elder-DBu0Okgw.js";/* empty css                                                              */import Fe from"./Result-B6buoJVe.js";import{g as ze}from"./roles-Cdu4wKiR.js";import{g as Ee}from"./user-D8WAOQH1.js";import{g as Pe}from"./scaleSet-MWCuoDeT.js";import"./jspdf.es.min-uZZ0fheg.js";const $e={class:"dialog-footer"},Be={class:"report-view"},Ie={class:"user-wrap"},Ne={class:"form-box"},Ge={class:"type-wrap"},We={class:"info-wrap"},je={class:"info-item"},Le={class:"value"},qe={class:"info-item"},He={class:"value"},Oe={class:"info-item"},Je={class:"value"},Ke={class:"info-item"},Me={class:"value"},Qe={class:"doctor-wrap"},Xe={class:"doctor-title"},Ye={class:"doctor-title"},Ze={key:0,class:"result success"},he={key:1,class:"result warning"},el={key:2,class:"result danger"},ll={class:"flex-center"},sl={class:"doctor-title"},tl={class:"warn-wrap"},al={class:"doctor-title"},ol={class:"dialog-footer"},il={class:"report-view"},nl={class:"user-wrap"},dl={class:"username"},rl={class:"text"},ul={class:"info-wrap"},vl={class:"info-item"},pl={class:"value"},_l={class:"info-item"},cl={class:"value"},ml={class:"info-item"},fl={class:"value"},gl={class:"info-item"},bl={class:"value"},yl={class:"doctor-wrap"},wl={class:"doctor-title"},kl={class:"doctor-info"},Vl={class:"black"},Cl={class:"doctor-title"},Dl={key:0,class:"result success"},xl={key:1,class:"result warning"},Al={key:2,class:"result danger"},Tl={class:"dot-result"},Rl={class:"value"},Sl={class:"doctor-title"},Ul={class:"warn-wrap"},Fl={class:"doctor-title"},zl={class:"status-wrap"},El={key:0,class:"status-img",src:ge,alt:""},Pl={key:1,class:"status-img",src:be,alt:""},$l={key:2,class:"status-img",src:ye,alt:""},Bl={key:3,class:"status-img",src:we,alt:""},Il={class:"status-text"},Nl={key:0},Gl={key:1},Wl={key:2},jl={key:3},Ll={key:4},ql={__name:"index",setup(Hl){const{proxy:U}=Ae(),F=Ue(),D=_({page:1,per_page:10}),$=_(!1),Q=_(0),B=_([]),le=()=>({backgroundColor:"#F6F8FF",color:"#C5C5C5"}),I=async()=>{$.value=!0;const n=await De({elder_id:F.elder.id,...D.value});$.value=!1,B.value=n.data.data,Q.value=n.data.total};Te(()=>F.elder,n=>{n.id&&I()},{immediate:!0});const N=_(!1),G=_({}),se=async n=>{const e=await ke({id:n.id,elder_id:F.elder.id});G.value=e.data,G.value.name=n.name,N.value=!0},W=_(null),te=async()=>{W.value&&await W.value.generatePDF()},x=_(!1),X=_(""),w=_({scale_set_id:"",final_result:""}),ae=_([{name:"已入住",value:1},{name:"未入住",value:0}]),m=_({}),oe=async()=>{const n=await Se({id:F.elder.id});m.value=n.data},A=_([]),ie=async()=>{const n=await ze({is_ca:1});A.value=n.data,A.value.forEach(async e=>{const{data:v}=await Ee({role_id:e.id});e.option=v})},Y=_([]),ne=async()=>{const n=await Pe();Y.value=n.data},de=async n=>{X.value=n.id,await oe(),await ie(),await ne(),x.value=!0},re=async()=>{for(const e of A.value)if(!e.select){U.$modal.msgWarning("请选择营养师");return}const n=A.value.map(e=>({role_id:e.id,user_id:e.select}));if(!w.value.scale_set_id){U.$modal.msgWarning("请选择评估类型");return}if(!w.value.final_result){U.$modal.msgWarning("请选择最终能力等级");return}await Ce({result_id:X.value,...w.value,participant:n}),x.value=!1,I(),U.$modal.msgSuccess("添加成功")},ue=()=>{x.value=!1},j=_(!1),r=_({}),Z=_([]),ve=async n=>{const e=await Ve({id:n.id});r.value=e.data,Z.value=[{name:"老人能力评估（GB/T42195-2022）",type:e.data.scale_set.name,time:e.data.updated_at,score:e.data.report.scale_result.score,result:e.data.report.scale_result.results}],j.value=!0};return(n,e)=>{const v=c("el-table-column"),L=c("el-tag"),k=c("el-button"),q=c("el-table"),H=c("Dialog"),T=c("el-col"),O=c("el-option"),J=c("el-select"),z=c("el-form-item"),pe=c("el-input"),K=c("el-row"),f=c("svg-icon"),R=c("el-radio"),_e=c("el-radio-group"),h=c("el-form"),ce=c("Pagination"),M=ee("hasPermi"),me=ee("loading");return o(),d(C,null,[P((o(),g(q,{class:"base-info-table",data:B.value,"header-cell-style":le},{default:a(()=>[s(v,{prop:"name",label:"评估名称",align:"center"}),s(v,{prop:"scale_set",label:"评估类型",align:"center"},{default:a(({row:t})=>[i(p(t.scale_set.name),1)]),_:1}),s(v,{prop:"status",label:"评估状态",align:"center"},{default:a(({row:t})=>[t.status==0?(o(),g(L,{key:0,type:"primary"},{default:a(()=>e[9]||(e[9]=[i(" 进行中 ")])),_:1,__:[9]})):u("",!0),t.status==1?(o(),g(L,{key:1,type:"success"},{default:a(()=>e[10]||(e[10]=[i(" 初步评估完成 ")])),_:1,__:[10]})):u("",!0),t.status==2?(o(),g(L,{key:2,type:"success"},{default:a(()=>e[11]||(e[11]=[i(" 已完成 ")])),_:1,__:[11]})):u("",!0)]),_:1}),s(v,{prop:"updated_at",label:"评估时间",align:"center"}),s(v,{prop:"result",label:"评估结果",align:"center"}),s(v,{prop:"action",label:"操作",align:"center",width:"120"},{default:a(t=>[t.row.status==0?P((o(),g(k,{key:0,type:"primary",plain:"",size:"default",onClick:b=>se(t.row)},{default:a(()=>e[12]||(e[12]=[i("查看结果")])),_:2,__:[12]},1032,["onClick"])),[[M,["GET.aas/result"]]]):u("",!0),t.row.status==1?P((o(),g(k,{key:1,type:"primary",plain:"",size:"default",onClick:b=>de(t.row)},{default:a(()=>e[13]||(e[13]=[i("添加报告")])),_:2,__:[13]},1032,["onClick"])),[[M,["POST.aas/report"]]]):u("",!0),t.row.status==2?P((o(),g(k,{key:2,type:"primary",plain:"",size:"default",onClick:b=>ve(t.row)},{default:a(()=>e[14]||(e[14]=[i("查看报告")])),_:2,__:[14]},1032,["onClick"])),[[M,["GET.aas/report/{result}"]]]):u("",!0)]),_:1})]),_:1},8,["data"])),[[me,$.value]]),s(H,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=t=>N.value=t),title:"综合能力评估结果",width:"1200"},{footer:a(()=>[l("div",$e,[s(k,{type:"primary",onClick:te},{default:a(()=>e[15]||(e[15]=[i("打印报告")])),_:1,__:[15]})])]),default:a(()=>[s(Fe,{ref_key:"resultRef",ref:W,data:G.value},null,8,["data"])]),_:1},8,["modelValue"]),s(H,{modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=t=>x.value=t),width:"1205",title:"新增报告"},{footer:a(()=>[l("div",ol,[s(k,{onClick:ue},{default:a(()=>e[36]||(e[36]=[i("取消")])),_:1,__:[36]}),s(k,{type:"primary",onClick:re},{default:a(()=>e[37]||(e[37]=[i(" 保存 ")])),_:1,__:[37]})])]),default:a(()=>[l("div",Be,[e[35]||(e[35]=l("div",{class:"report-view-title"},"老人能力等级划分",-1)),s(h,{"label-position":"top"},{default:a(()=>[l("div",Ie,[l("div",Ne,[s(K,{gutter:42},{default:a(()=>[s(T,{span:8},{default:a(()=>[l("div",Ge,[(o(!0),d(C,null,S(ae.value,(t,b)=>(o(),d("div",{class:Re(["type-item",{active:m.value.status==t.value}]),key:b},p(t.name),3))),128))])]),_:1}),s(T,{span:8},{default:a(()=>[s(z,null,{default:a(()=>[s(J,{modelValue:m.value.epartmene.id,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value.epartmene.id=t),disabled:""},{default:a(()=>[s(O,{label:m.value.epartmene.name,value:m.value.epartmene.id},null,8,["label","value"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(T,{span:8},{default:a(()=>[s(z,null,{default:a(()=>[s(pe,{modelValue:m.value.name,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value.name=t),placeholder:"请输入长者姓名",disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),l("div",We,[l("div",je,[e[16]||(e[16]=l("div",{class:"label"},"年龄",-1)),l("div",Le,p(m.value.age),1)]),l("div",qe,[e[17]||(e[17]=l("div",{class:"label"},"性别",-1)),l("div",He,p(n.genderFormat(m.value.sex)),1)]),l("div",Oe,[e[18]||(e[18]=l("div",{class:"label"},"科别",-1)),l("div",Je,p(m.value.epartmene.name),1)]),l("div",Ke,[e[19]||(e[19]=l("div",{class:"label"},"床位号",-1)),l("div",Me,p(m.value.building.name)+"/ "+p(m.value.room.name)+"/ "+p(m.value.bed.name),1)])])]),l("div",Qe,[l("div",Xe,[l("div",null,[s(f,{"icon-class":"doctor",class:"svg-icon"}),e[20]||(e[20]=i(" 选择医药师 "))])]),s(K,{gutter:63},{default:a(()=>[(o(!0),d(C,null,S(A.value,(t,b)=>(o(),g(T,{span:12,key:b},{default:a(()=>[s(z,{label:t.name},{default:a(()=>[s(J,{modelValue:t.select,"onUpdate:modelValue":V=>t.select=V,placeholder:"请选择"},{default:a(()=>[(o(!0),d(C,null,S(t.option,(V,E)=>(o(),g(O,{key:E,label:V.name,value:V.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),l("div",Ye,[l("div",null,[s(f,{"icon-class":"star",class:"svg-icon"}),e[21]||(e[21]=i(" 评估量表得分 "))])]),s(q,{data:B.value,border:""},{default:a(()=>[s(v,{type:"index",label:"序号",width:"120",align:"center"}),s(v,{prop:"name",label:"量表名称",align:"center"}),s(v,{prop:"score",label:"得分",align:"center"}),s(v,{prop:"scale_set",label:"评估类型",align:"center"},{default:a(({row:t})=>[i(p(t.scale_set.name),1)]),_:1}),s(v,{prop:"updated_at",label:"评估时间",align:"center"}),s(v,{prop:"result",label:"结果",align:"center"},{default:a(({row:t})=>[t.resultType==1?(o(),d("div",Ze,e[22]||(e[22]=[l("div",{class:"dot success"},null,-1),l("span",null,"能力完好",-1)]))):u("",!0),t.resultType==2?(o(),d("div",he,e[23]||(e[23]=[l("div",{class:"dot warning"},null,-1),l("span",null,"轻度受损",-1)]))):u("",!0),t.resultType==3?(o(),d("div",el,e[24]||(e[24]=[l("div",{class:"dot danger"},null,-1),l("span",null,"中度受损",-1)]))):u("",!0)]),_:1})]),_:1},8,["data"]),l("div",ll,[e[25]||(e[25]=l("div",{class:"sub-title"},"评估类型",-1)),s(J,{modelValue:w.value.scale_set_id,"onUpdate:modelValue":e[3]||(e[3]=t=>w.value.scale_set_id=t),placeholder:"请选择",style:{width:"515px"}},{default:a(()=>[(o(!0),d(C,null,S(Y.value,t=>(o(),g(O,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",sl,[l("div",null,[s(f,{"icon-class":"medal",class:"svg-icon"}),e[26]||(e[26]=i(" 老人能力等级划分标准 "))])]),e[34]||(e[34]=l("div",{class:"assess-list"},[l("div",{class:"title"}," 有以下情况之一者,在原有能力级别上应提高一个级别: "),l("div",{class:"assess-item"},[l("div",{class:"label"},"1.确诊为痴呆")]),l("div",{class:"assess-item"},[l("div",{class:"label"}," 2.精神科专科医生诊断的其他精神和行为障碍疾病 ")]),l("div",{class:"assess-item"},[l("div",{class:"label"}," 3.近 30天内发生过2次及以上照护风险事件(如跌倒、噎食自杀、自伤、走失等)。 ")])],-1)),l("div",tl,[s(f,{"icon-class":"warn",class:"svg-icon"}),e[27]||(e[27]=i(" 处于昏迷状态者,直接评定为能力完全丧失(完全失能)。 "))]),l("div",al,[l("div",null,[s(f,{"icon-class":"triangle",class:"svg-icon"}),e[28]||(e[28]=i(" 最终老人能力等级 "))])]),s(_e,{modelValue:w.value.final_result,"onUpdate:modelValue":e[4]||(e[4]=t=>w.value.final_result=t)},{default:a(()=>[s(R,{value:0,size:"large"},{default:a(()=>e[29]||(e[29]=[i("0级能力完好")])),_:1,__:[29]}),s(R,{value:1,size:"large"},{default:a(()=>e[30]||(e[30]=[i("1级轻度失能")])),_:1,__:[30]}),s(R,{value:2,size:"large"},{default:a(()=>e[31]||(e[31]=[i("2级中度失能")])),_:1,__:[31]}),s(R,{value:3,size:"large"},{default:a(()=>e[32]||(e[32]=[i("3级重度失能")])),_:1,__:[32]}),s(R,{value:4,size:"large"},{default:a(()=>e[33]||(e[33]=[i("4级完全失能")])),_:1,__:[33]})]),_:1},8,["modelValue"])])]),_:1})])]),_:1},8,["modelValue"]),s(H,{modelValue:j.value,"onUpdate:modelValue":e[6]||(e[6]=t=>j.value=t),width:"1205",title:"查看报告"},{default:a(()=>{var t,b,V,E;return[l("div",il,[e[52]||(e[52]=l("div",{class:"report-view-title"},"老人能力等级划分",-1)),l("div",nl,[l("div",dl,[l("div",rl,[s(f,{"icon-class":"user-2",class:"svg-icon"}),i(" "+p(r.value.elder.name),1)]),s(k,{type:"primary",round:""},{default:a(()=>{var y;return[i(p(n.statusFormat((y=r.value.elder)==null?void 0:y.status)),1)]}),_:1})]),l("div",ul,[l("div",vl,[e[38]||(e[38]=l("div",{class:"label"},"年龄",-1)),l("div",pl,p(r.value.elder.age),1)]),l("div",_l,[e[39]||(e[39]=l("div",{class:"label"},"性别",-1)),l("div",cl,p(n.genderFormat((t=r.value.elder)==null?void 0:t.sex)),1)]),l("div",ml,[e[40]||(e[40]=l("div",{class:"label"},"科别",-1)),l("div",fl,p(r.value.elder.epartmene.name),1)]),l("div",gl,[e[41]||(e[41]=l("div",{class:"label"},"床位号",-1)),l("div",bl,p((b=r.value.elder.building)==null?void 0:b.name)+"/ "+p((V=r.value.elder.room)==null?void 0:V.name)+"/ "+p((E=r.value.elder.bed)==null?void 0:E.name),1)])])]),l("div",yl,[l("div",wl,[s(f,{"icon-class":"doctor",class:"svg-icon"}),e[42]||(e[42]=i(" 医药师 "))]),l("div",kl,[s(h,{"label-width":"120"},{default:a(()=>[s(K,null,{default:a(()=>[(o(!0),d(C,null,S(r.value.participant,(y,fe)=>(o(),g(T,{key:fe,span:6},{default:a(()=>[s(z,{label:y.role_name},{default:a(()=>[l("div",Vl,p(y.user_name),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1})]),l("div",Cl,[s(f,{"icon-class":"star",class:"svg-icon"}),e[43]||(e[43]=i(" 评估量表得分 "))]),s(q,{data:Z.value,border:""},{default:a(()=>[s(v,{type:"index",label:"序号",width:"120",align:"center"}),s(v,{prop:"name",label:"量表名称",align:"center"}),s(v,{prop:"score",label:"得分",align:"center"}),s(v,{prop:"type",label:"评估类型",align:"center"}),s(v,{prop:"time",label:"评估时间",align:"center"}),s(v,{prop:"result",label:"结果",align:"center"},{default:a(({row:y})=>[y.resultType==1?(o(),d("div",Dl,e[44]||(e[44]=[l("div",{class:"dot success"},null,-1),l("span",null,"能力完好",-1)]))):u("",!0),y.resultType==2?(o(),d("div",xl,e[45]||(e[45]=[l("div",{class:"dot warning"},null,-1),l("span",null,"轻度受损",-1)]))):u("",!0),y.resultType==3?(o(),d("div",Al,e[46]||(e[46]=[l("div",{class:"dot danger"},null,-1),l("span",null,"中度受损",-1)]))):u("",!0)]),_:1})]),_:1},8,["data"]),l("div",Tl,[e[47]||(e[47]=l("div",{class:"label"},"评估类型",-1)),l("div",Rl,p(r.value.scale_set.name),1)]),l("div",Sl,[l("div",null,[s(f,{"icon-class":"medal",class:"svg-icon"}),e[48]||(e[48]=i(" 老人能力等级划分标准 "))])]),e[51]||(e[51]=l("div",{class:"assess-list"},[l("div",{class:"title"}," 有以下情况之一者,在原有能力级别上应提高一个级别: "),l("div",{class:"assess-item"},[l("div",{class:"label"},"1.确诊为痴呆")]),l("div",{class:"assess-item"},[l("div",{class:"label"}," 2.精神科专科医生诊断的其他精神和行为障碍疾病 ")]),l("div",{class:"assess-item"},[l("div",{class:"label"}," 3.近 30天内发生过2次及以上照护风险事件(如跌倒、噎食自杀、自伤、走失等)。 ")])],-1)),l("div",Ul,[s(f,{"icon-class":"warn",class:"svg-icon"}),e[49]||(e[49]=i(" 处于昏迷状态者,直接评定为能力完全丧失(完全失能)。 "))]),l("div",Fl,[l("div",null,[s(f,{"icon-class":"triangle",class:"svg-icon"}),e[50]||(e[50]=i(" 最终老人能力等级 "))])]),l("div",zl,[r.value.report.final_result==0||r.value.report.final_result==1?(o(),d("img",El)):u("",!0),r.value.report.final_result==2?(o(),d("img",Pl)):u("",!0),r.value.report.final_result==3?(o(),d("img",$l)):u("",!0),r.value.report.final_result==4?(o(),d("img",Bl)):u("",!0),l("div",Il,[r.value.report.final_result==0?(o(),d("span",Nl,"0级能力完好")):u("",!0),r.value.report.final_result==1?(o(),d("span",Gl,"1级轻度失能")):u("",!0),r.value.report.final_result==2?(o(),d("span",Wl,"2级中度失能")):u("",!0),r.value.report.final_result==3?(o(),d("span",jl,"3级重度失能")):u("",!0),r.value.report.final_result==4?(o(),d("span",Ll,"4级完全失能")):u("",!0)])])])])]}),_:1},8,["modelValue"]),s(ce,{class:"pagination",total:Q.value,layout:"total, prev, pager, next, jumper",page:D.value.page,"onUpdate:page":e[7]||(e[7]=t=>D.value.page=t),limit:D.value.per_page,"onUpdate:limit":e[8]||(e[8]=t=>D.value.per_page=t),onPagination:I},null,8,["total","page","limit"])],64)}}},ss=xe(ql,[["__scopeId","data-v-b6e9643c"]]);export{ss as default};
