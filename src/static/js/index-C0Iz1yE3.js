import{p as z,c as G,d as H}from"./index-DflO1dAi.js";import{g as J}from"./scaleSet-MWCuoDeT.js";import{u as K}from"./workstation-CZReWDJu.js";import{_ as M,d as Q,u as X,a as Y,r as u,w as Z,e as y,D as ee,c as o,o as s,f as n,h as m,B as te,p as i,F as _,v,x as se,t as r,E as oe,j as k,i as d,O as $,A as B}from"./index-gubRP18q.js";import{u as ae}from"./elder-DBu0Okgw.js";const le={class:"project-wrap hide-scrollbar"},ne={key:0,class:"tag-wrap"},ie=["onClick"],re={class:"assessment-content hide-scrollbar"},de={class:"project-title"},ce={class:"project-type hide-scrollbar"},ue={class:"l"},_e={class:"v"},pe={class:"project-action"},me=["onClick"],ve={key:1,style:{width:"100%"}},fe={class:"assessment-type"},ge={class:"form-item-title"},ye={style:{width:"800px"}},ke={class:"dialog-footer"},we={__name:"index",setup(he){const{proxy:w}=Q(),h=K(),j=X();Y();const b=ae(),V=u([]),x=async()=>{var e;const a=await G({id:j.query.id,tags_key:(e=h.tags[C.value])==null?void 0:e.key,page:1,per_page:1e3});V.value=a.data.data},C=u(0),I=(a,e)=>{C.value=e,x()};Z(()=>j.query,a=>{a.id&&x()},{immediate:!0});const p=u(!1),f=u(""),g=u({}),S=u(""),A=u([]),N=async()=>{const a=await J();A.value=a.data},U=async()=>{const a=await H({id:S.value,elder_id:b.elder.id});g.value=a.data},E=async a=>{S.value=a.id,await N(),await U(),p.value=!0},R=()=>{p.value=!1},q=async()=>{if(!f.value){w.$modal.msgWarning("请选择评估类型");return}for(const e of g.value.topic_list)if(!e.radio){w.$modal.msgWarning(`请回答问题${e.topic}`);return}const a=g.value.topic_list.map(e=>({topic_id:e.id,option_id:e.radio}));await z({elder_id:b.elder.id,scale_id:S.value,scale_set_id:f.value,answers:a}),w.$modal.msgSuccess("提交成功"),p.value=!1};return(a,e)=>{var T;const F=y("el-empty"),W=y("el-radio"),D=y("el-radio-group"),P=y("el-button"),L=y("Dialog"),O=ee("hasPermi");return s(),o(_,null,[n("div",le,[i(h).tags.length>0?(s(),o("div",ne,[(s(!0),o(_,null,v(i(h).tags,(t,l)=>(s(),o("div",{class:se(["tag-item",{active:i(C)==l}]),key:l,onClick:c=>I(t,l)},r(t.value),11,ie))),128))])):te("",!0),n("div",re,[i(V).length>0?(s(!0),o(_,{key:0},v(i(V),t=>(s(),o("div",{class:"project-item",key:t.id},[n("div",de,r(t.name),1),n("div",ce,[(s(!0),o(_,null,v(t.use_count,l=>(s(),o("div",{key:l.id,class:"project-type-item"},[n("div",ue,r(l.name),1),n("div",_e,r(l.count)+"次",1)]))),128))]),n("div",pe,[oe((s(),o("div",{class:"btn-2",onClick:l=>E(t)},e[2]||(e[2]=[k(" 开始评估 ")]),8,me)),[[O,["POST.workstation/{scale}/submit"]]])])]))),128)):(s(),o("div",ve,[m(F)]))])]),m(L,{modelValue:i(p),"onUpdate:modelValue":e[1]||(e[1]=t=>$(p)?p.value=t:null),title:(T=i(g).scale)==null?void 0:T.name,width:"909"},{footer:d(()=>[n("div",ke,[m(P,{onClick:R},{default:d(()=>e[4]||(e[4]=[k("取消")])),_:1,__:[4]}),m(P,{type:"primary",onClick:q},{default:d(()=>e[5]||(e[5]=[k(" 确认 ")])),_:1,__:[5]})])]),default:d(()=>[n("div",fe,[m(D,{modelValue:i(f),"onUpdate:modelValue":e[0]||(e[0]=t=>$(f)?f.value=t:null)},{default:d(()=>[(s(!0),o(_,null,v(i(A),(t,l)=>(s(),B(W,{key:l,value:t.id},{default:d(()=>[k(r(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),(s(!0),o(_,null,v(i(g).topic_list,(t,l)=>(s(),o("div",{key:t.id,class:"form-item"},[n("div",ge,r(l+1)+"、"+r(t.topic),1),e[3]||(e[3]=n("div",{class:"form-item-desc"},null,-1)),m(D,{modelValue:t.radio,"onUpdate:modelValue":c=>t.radio=c},{default:d(()=>[(s(!0),o(_,null,v(t.options,c=>(s(),B(W,{key:c.id,value:c.id},{default:d(()=>[n("div",ye,r(c.no)+"."+r(c.option),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),_:1},8,["modelValue","title"])],64)}}},xe=M(we,[["__scopeId","data-v-47aefecc"]]);export{xe as default};
