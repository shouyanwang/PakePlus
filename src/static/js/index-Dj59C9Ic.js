import{a as oe,p as ne,b as se,c as ue,d as re}from"./roles-Cdu4wKiR.js";import{g as de}from"./epartmene-D2Rd6sgX.js";import{_ as pe,d as ie,r as p,e as s,D as M,c as A,o as i,f as O,h as e,E as k,i as a,A as v,j as u,B as me,F as j,v as H,t as U,al as _e}from"./index-gubRP18q.js";const fe={class:"search-form"},ve={class:"dialog-footer"},ge={__name:"index",setup(ce){const{proxy:g}=ie(),_=p({keyword:"",page:1,per_page:10}),E=p(!1),q=p(0),P=p([]),I={1:"全部",2:"本部门",3:"自定义"},G=()=>({backgroundColor:"#F6F8FF",color:"#C5C5C5"}),c=async()=>{E.value=!0;const n=await oe(_.value);E.value=!1,P.value=n.data.data,q.value=n.data.total};c();const Q=()=>{_.value.page=1,c()},z=p(null),t=p({name:"",data_type:"",epartmene_ids:[],status:"",order:"",explain:"",nodes:[],is_ca:""}),J=p({name:[{required:!0,message:"请输入科室名称",trigger:"blur"}],data_type:[{required:!0,message:"请选择数据范围",trigger:"change"}],order:[{required:!0,message:"请输入排序",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],nodes:[{required:!0,message:"请选择菜单",trigger:"change"}],is_ca:[{required:!0,message:"请选择是否参与评估",trigger:"change"}]}),F=p([]);(async()=>{const n=await _e();F.value=n.data})();const S=p([]);(async()=>{const n=await de();S.value=n.data})();const f=p(!1),T=p(""),D=()=>{t.value.id="",Object.keys(t.value).forEach(n=>{t.value[n]=""}),g.resetForm("formRef")},K=()=>{D(),T.value="新增角色",f.value=!0},W=async n=>{D();const l=await ue({id:n.id});f.value=!0,T.value="修改角色",Object.keys(t.value).forEach(r=>{t.value[r]=l.data[r]}),t.value.id=n.id,t.value.nodes=l.data.nodes.map(r=>r.menu_id),t.value.epartmene_ids=l.data.epartmene_ids.split(",").map(r=>Number(r))},X=()=>{f.value=!1,D()},Y=()=>{g.$refs.formRef.validate(async n=>{n&&(t.value.id!=""?(await ne({...t.value,nodes:t.value.nodes.join(","),epartmene_ids:t.value.epartmene_ids?t.value.epartmene_ids.join(","):""}),g.$modal.msgSuccess("修改成功"),f.value=!1,c()):(await se({...t.value,nodes:t.value.nodes.join(","),epartmene_ids:t.value.epartmene_ids?t.value.epartmene_ids.join(","):""}),g.$modal.msgSuccess("新增成功"),f.value=!1,c()))})},Z=n=>{g.$modal.confirm("是否确认删除角色?").then(async()=>{await re({id:n.id}),g.$modal.msgSuccess("删除成功"),c()}).catch(()=>{})};return(n,l)=>{const r=s("el-input"),m=s("el-form-item"),d=s("el-col"),y=s("el-button"),b=s("el-row"),$=s("el-form"),x=s("el-option"),B=s("el-select"),h=s("el-tree-select"),C=s("el-radio"),L=s("el-radio-group"),ee=s("Dialog"),V=s("el-table-column"),ae=s("el-table"),le=s("Pagination"),w=M("hasPermi"),te=M("loading");return i(),A(j,null,[O("div",fe,[e($,{model:_.value,ref:"queryRef"},{default:a(()=>[e(b,{gutter:30},{default:a(()=>[e(d,{span:8},{default:a(()=>[e(m,{label:"角色名",prop:"keyword"},{default:a(()=>[e(r,{modelValue:_.value.keyword,"onUpdate:modelValue":l[0]||(l[0]=o=>_.value.keyword=o),placeholder:"请输入名称或描述搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:a(()=>[e(m,null,{default:a(()=>[k((i(),v(y,{type:"primary",icon:"Search",onClick:Q},{default:a(()=>l[12]||(l[12]=[u("查询")])),_:1,__:[12]})),[[w,["GET.roles"]]]),k((i(),v(y,{icon:"plus",type:"primary",onClick:K},{default:a(()=>l[13]||(l[13]=[u("新增角色")])),_:1,__:[13]})),[[w,["POST.roles"]]])]),_:1})]),_:1}),e(d,{span:8})]),_:1})]),_:1},8,["model"])]),e(ee,{modelValue:f.value,"onUpdate:modelValue":l[9]||(l[9]=o=>f.value=o),title:"新增角色",width:"936"},{footer:a(()=>[O("div",ve,[e(y,{onClick:X},{default:a(()=>l[18]||(l[18]=[u("取消")])),_:1,__:[18]}),e(y,{type:"primary",onClick:Y},{default:a(()=>l[19]||(l[19]=[u(" 确认 ")])),_:1,__:[19]})])]),default:a(()=>[e($,{model:t.value,rules:J.value,ref_key:"formRef",ref:z,"label-position":"top"},{default:a(()=>[e(b,{gutter:52},{default:a(()=>[e(d,{span:12},{default:a(()=>[e(m,{label:"角色名称",prop:"name"},{default:a(()=>[e(r,{modelValue:t.value.name,"onUpdate:modelValue":l[1]||(l[1]=o=>t.value.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:a(()=>[e(m,{label:"数据范围",prop:"data_type"},{default:a(()=>[e(B,{modelValue:t.value.data_type,"onUpdate:modelValue":l[2]||(l[2]=o=>t.value.data_type=o),placeholder:"请选择数据范围"},{default:a(()=>[e(x,{label:"全部",value:1}),e(x,{label:"本部门",value:2}),e(x,{label:"自定义",value:3})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:56},{default:a(()=>[e(d,{span:t.value.data_type==3?12:24},{default:a(()=>[e(m,{label:"菜单分配",prop:"nodes"},{default:a(()=>[e(h,{modelValue:t.value.nodes,"onUpdate:modelValue":l[3]||(l[3]=o=>t.value.nodes=o),data:F.value,props:{value:"id",label:"title",children:"all_children"},"value-key":"id",multiple:"","render-after-expand":!1,"show-checkbox":"","tag-type":"primary","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":t.value.data_type==3?3:7,placeholder:"请选择菜单"},null,8,["modelValue","data","max-collapse-tags"])]),_:1})]),_:1},8,["span"]),t.value.data_type==3?(i(),v(d,{key:0,span:12},{default:a(()=>[e(m,{label:"数据权限",prop:"epartmene_ids"},{default:a(()=>[e(B,{modelValue:t.value.epartmene_ids,"onUpdate:modelValue":l[4]||(l[4]=o=>t.value.epartmene_ids=o),multiple:"","tag-type":"primary","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":4,placeholder:"请选择数据权限"},{default:a(()=>[(i(!0),A(j,null,H(S.value,o=>(i(),v(x,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):me("",!0)]),_:1}),e(b,{gutter:56},{default:a(()=>[e(d,{span:12},{default:a(()=>[e(m,{label:"排序",prop:"order"},{default:a(()=>[e(r,{modelValue:t.value.order,"onUpdate:modelValue":l[5]||(l[5]=o=>t.value.order=o),placeholder:"请输入排序",type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:a(()=>[e(m,{label:"状态",prop:"status"},{default:a(()=>[e(L,{modelValue:t.value.status,"onUpdate:modelValue":l[6]||(l[6]=o=>t.value.status=o)},{default:a(()=>[e(C,{value:1},{default:a(()=>l[14]||(l[14]=[u("正常")])),_:1,__:[14]}),e(C,{value:0},{default:a(()=>l[15]||(l[15]=[u("隐藏")])),_:1,__:[15]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,null,{default:a(()=>[e(d,{span:12},{default:a(()=>[e(m,{label:"是否参与评估",prop:"is_ca"},{default:a(()=>[e(L,{modelValue:t.value.is_ca,"onUpdate:modelValue":l[7]||(l[7]=o=>t.value.is_ca=o)},{default:a(()=>[e(C,{value:1},{default:a(()=>l[16]||(l[16]=[u("是")])),_:1,__:[16]}),e(C,{value:0},{default:a(()=>l[17]||(l[17]=[u("否")])),_:1,__:[17]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,null,{default:a(()=>[e(d,{span:24},{default:a(()=>[e(m,{label:"描述信息",prop:"explain"},{default:a(()=>[e(r,{modelValue:t.value.explain,"onUpdate:modelValue":l[8]||(l[8]=o=>t.value.explain=o),placeholder:"请输入描述",type:"textarea",rows:4},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),k((i(),v(ae,{class:"base-info-table",data:P.value,"header-cell-style":G},{default:a(()=>[e(V,{prop:"name",label:"名称",align:"center"}),e(V,{prop:"data_type",label:"数据范围",align:"center"},{default:a(({row:o})=>[u(U(I[o.data_type]),1)]),_:1}),e(V,{prop:"epartmene",label:"科室",align:"center"},{default:a(({row:o})=>[(i(!0),A(j,null,H(o.epartmene,(R,N)=>(i(),A("span",{key:N},U(R.name)+" "+U(N==o.epartmene.length-1?"":"、"),1))),128))]),_:1}),e(V,{prop:"is_ca",label:"是否参与评估",align:"center"},{default:a(({row:o})=>[u(U(o.is_ca==1?"是":"否"),1)]),_:1}),e(V,{prop:"explain",label:"描述",align:"center"}),e(V,{prop:"action",label:"操作",align:"center",width:"160"},{default:a(({row:o})=>[k((i(),v(y,{type:"primary",plain:"",onClick:R=>W(o)},{default:a(()=>l[20]||(l[20]=[u("修改")])),_:2,__:[20]},1032,["onClick"])),[[w,["PATCH.roles/{role}"]]]),k((i(),v(y,{type:"danger",plain:"",onClick:R=>Z(o)},{default:a(()=>l[21]||(l[21]=[u("删除")])),_:2,__:[21]},1032,["onClick"])),[[w,["DELETE.roles/{role}"]]])]),_:1})]),_:1},8,["data"])),[[te,E.value]]),e(le,{total:q.value,layout:"total, prev, pager, next, jumper",page:_.value.page,"onUpdate:page":l[10]||(l[10]=o=>_.value.page=o),limit:_.value.per_page,"onUpdate:limit":l[11]||(l[11]=o=>_.value.per_page=o),onPagination:c},null,8,["total","page","limit"])],64)}}},Ce=pe(ge,[["__scopeId","data-v-a01e9dc8"]]);export{Ce as default};
