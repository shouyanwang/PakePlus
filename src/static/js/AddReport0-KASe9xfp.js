import{p as Ae}from"./index-CY7xaJsh.js";import{a as ke}from"./index-BdLHAAwy.js";import{g as xe}from"./baseInfo-CQ1nngzO.js";import{g as Ce}from"./epartmene-CB3UALfk.js";import{g as Ue}from"./roles-DRzLFWIE.js";import{g as $e}from"./user-BtHrfomU.js";import{g as Se}from"./scaleSet-CH4yhRsR.js";import{g as De}from"./point-WriSaPwI.js";import{a as We}from"./index-CbSnCnmH.js";import{_ as Ee,d as Pe,r,w as Re,e as u,A as k,o as i,i as o,f as n,h as e,c as v,F as x,v as C,p as t,x as Be,t as V,j as c,Q as F}from"./index-BCPe6f7k.js";const Te={class:"report-view"},Ie={class:"user-wrap"},Le={class:"form-box"},he={class:"type-wrap"},je=["onClick"],Fe={class:"info-wrap"},Ne={class:"info-item"},Qe={class:"value"},qe={class:"info-item"},ze={key:0,class:"value"},Oe={key:1,class:"value"},Ge={class:"info-item"},He={class:"value"},Je={class:"info-item"},Ke={key:0,class:"value"},Me={key:1},Xe={class:"doctor-wrap"},Ye={class:"doctor-title"},Ze={class:"doctor-title"},el={class:"doctor-title"},ll={class:"doctor-title"},al={class:"doctor-title"},tl={class:"doctor-title"},ol={class:"dialog-footer"},nl={__name:"AddReport0",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(te,{emit:oe}){const{proxy:g}=Pe(),q=te,z=oe,U=r(q.modelValue);Re(()=>q.modelValue,async s=>{s==!0&&(g.$modal.loading("加载中..."),await de(),await N(),await re(),await ue(),await pe()),g.$modal.closeLoading(),U.value=s});const ne=()=>{z("update:modelValue",!1)},R=r(!1),D=r("med_guid"),d=r({elder_id:"",scale_set_id:"",type:0,result_ids:"",case_overview:"",current_diagnosis:"",purpose:"",med_guid:"",tcm_sdt:"",med_care:"",rehab_ther:"",nutri_diet:"",psy_couns:"",ex_pres:"",daily_care:"",exo:"",final_result:""}),W=r({status:1,epartmene_id:"",page:1,per_page:1e3}),se=r([{name:"已入住",value:1},{name:"未入住",value:0}]),O=r([]),de=async()=>{const s=await Ce();O.value=s.data},f=r({}),G=async()=>{if(d.value.elder_id){f.value;const s=await xe({id:d.value.elder_id});f.value=s.data}else f.value={}},H=r([]),N=async()=>{d.value.elder_id="",await G();const s=await ke(W.value);H.value=s.data.data},ie=(s,l)=>{W.value.status=s.value,N()},E=r([]),re=async()=>{const s=await Ue({is_ca:1});E.value=s.data,E.value.forEach(async l=>{const{data:p}=await $e({role_id:l.id});l.option=p})},J=r([]),ue=async()=>{const s=await Se();J.value=s.data},Q=r([]),pe=async()=>{const s=await De();Q.value=s.data},B=r(""),ce=()=>{const s=Q.value.find(b=>b.id==B.value),{id:l,name:p,...m}=s;Object.keys(m).forEach(b=>{d.value[b]=m[b]})},K=r([]),T=r({page:1,per_page:10}),M=r(0),X=async()=>{const s=await We({id:d.value.elder_id,type:0});K.value=s.data.data,M.value=s.data.total},me=async()=>{if(!d.value.elder_id){g.$modal.msgWarning("请选择长者");return}await X(),R.value=!0},$=r([]),_e=s=>{$.value=s},ve=s=>{let l=$.value.findIndex(p=>p.id==s.id);$.value.splice(l,1)},ge=()=>{U.value=!1},fe=async()=>{if(!d.value.elder_id){g.$modal.msgWarning("请选择长者");return}for(const l of E.value)if(!l.select){g.$modal.msgWarning("请选择医药师");return}const s=E.value.map(l=>({role_id:l.id,user_id:l.select}));if(!d.value.case_overview){g.$modal.msgWarning("请填写病例概况");return}if(!d.value.current_diagnosis){g.$modal.msgWarning("请填写目前诊断");return}if($.value.length==0){g.$modal.msgWarning("请选择评估量表");return}if(!d.value.scale_set_id){g.$modal.msgWarning("请填写报告类型");return}if(d.value.final_result===""){g.$modal.msgWarning("请填写评估结果");return}await Ae({...d.value,type:0,participant:s,result_ids:$.value.map(l=>l.id).join(",")}),g.$modal.msgSuccess("添加成功"),U.value=!1,z("success")};return(s,l)=>{const p=u("el-col"),m=u("el-option"),b=u("el-select"),w=u("el-form-item"),I=u("el-row"),S=u("svg-icon"),L=u("el-input"),h=u("el-button"),_=u("el-table-column"),Y=u("el-table"),be=u("Pagination"),Z=u("Dialog"),A=u("el-tab-pane"),ye=u("el-tabs"),Ve=u("el-form");return i(),k(Z,{modelValue:t(U),"onUpdate:modelValue":l[13]||(l[13]=j=>F(U)?U.value=j:null),width:"1205",title:"新增报告",onClose:ne},{footer:o(()=>[n("div",ol,[e(h,{onClick:ge},{default:o(()=>l[27]||(l[27]=[c("取消")])),_:1,__:[27]}),e(h,{type:"primary",onClick:fe},{default:o(()=>l[28]||(l[28]=[c(" 保存 ")])),_:1,__:[28]})])]),default:o(()=>[n("div",Te,[l[26]||(l[26]=n("div",{class:"report-view-title"},"综合评估报告",-1)),e(Ve,{"label-position":"top"},{default:o(()=>{var j,ee,le,ae;return[n("div",Ie,[n("div",Le,[e(I,{gutter:42},{default:o(()=>[e(p,{span:8},{default:o(()=>[n("div",he,[(i(!0),v(x,null,C(t(se),(a,y)=>(i(),v("div",{class:Be(["type-item",{active:t(W).status==a.value}]),key:y,onClick:P=>ie(a,y)},V(a.name),11,je))),128))])]),_:1}),e(p,{span:8},{default:o(()=>[e(w,null,{default:o(()=>[e(b,{modelValue:t(W).epartmene_id,"onUpdate:modelValue":l[0]||(l[0]=a=>t(W).epartmene_id=a),placeholder:"请选择所属科室",onChange:N},{default:o(()=>[(i(!0),v(x,null,C(t(O),(a,y)=>(i(),k(m,{key:y,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:o(()=>[e(w,null,{default:o(()=>[e(b,{modelValue:t(d).elder_id,"onUpdate:modelValue":l[1]||(l[1]=a=>t(d).elder_id=a),placeholder:"请选择长者",onChange:G},{default:o(()=>[(i(!0),v(x,null,C(t(H),(a,y)=>(i(),k(m,{key:y,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),n("div",Fe,[n("div",Ne,[l[14]||(l[14]=n("div",{class:"label"},"年龄",-1)),n("div",Qe,V(t(f).age||"--"),1)]),n("div",qe,[l[15]||(l[15]=n("div",{class:"label"},"性别",-1)),t(f).sex?(i(),v("div",ze,V(s.genderFormat(t(f).sex)||"--"),1)):(i(),v("div",Oe,"--"))]),n("div",Ge,[l[16]||(l[16]=n("div",{class:"label"},"科别",-1)),n("div",He,V(((j=t(f).epartmene)==null?void 0:j.name)||"--"),1)]),n("div",Je,[l[17]||(l[17]=n("div",{class:"label"},"床位号",-1)),t(f).bed?(i(),v("div",Ke,V((ee=t(f).building)==null?void 0:ee.name)+"/ "+V((le=t(f).room)==null?void 0:le.name)+"/ "+V((ae=t(f).bed)==null?void 0:ae.name),1)):(i(),v("div",Me,"--"))])])]),n("div",Xe,[n("div",Ye,[n("div",null,[e(S,{"icon-class":"doctor",class:"svg-icon"}),l[18]||(l[18]=c(" 选择医药师 "))])]),e(I,{gutter:63},{default:o(()=>[(i(!0),v(x,null,C(t(E),(a,y)=>(i(),k(p,{span:12,key:y},{default:o(()=>[e(w,{label:a.name},{default:o(()=>[e(b,{modelValue:a.select,"onUpdate:modelValue":P=>a.select=P,placeholder:"请选择"},{default:o(()=>[(i(!0),v(x,null,C(a.option,(P,we)=>(i(),k(m,{key:we,label:P.name,value:P.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),n("div",Ze,[n("div",null,[e(S,{"icon-class":"case",class:"svg-icon"}),l[19]||(l[19]=c(" 病例概况 "))])]),e(w,null,{default:o(()=>[e(L,{modelValue:t(d).case_overview,"onUpdate:modelValue":l[2]||(l[2]=a=>t(d).case_overview=a),type:"textarea",rows:5,placeholder:"请输入病例概况"},null,8,["modelValue"])]),_:1}),n("div",el,[n("div",null,[e(S,{"icon-class":"bar",class:"svg-icon"}),l[20]||(l[20]=c(" 目前诊断 "))])]),e(w,null,{default:o(()=>[e(L,{modelValue:t(d).current_diagnosis,"onUpdate:modelValue":l[3]||(l[3]=a=>t(d).current_diagnosis=a),type:"textarea",rows:5,placeholder:"请输入目前诊断"},null,8,["modelValue"])]),_:1}),n("div",ll,[n("div",null,[e(S,{"icon-class":"star",class:"svg-icon"}),l[21]||(l[21]=c(" 各评估量表得分 "))]),e(h,{icon:"plus",type:"primary",onClick:me},{default:o(()=>l[22]||(l[22]=[c("新增量表得分")])),_:1,__:[22]})]),e(Z,{modelValue:t(R),"onUpdate:modelValue":l[6]||(l[6]=a=>F(R)?R.value=a:null),width:"1091",title:"新增量表得分",appendToBody:""},{default:o(()=>[e(Y,{data:t(K),"row-key":"id",onSelectionChange:_e},{default:o(()=>[e(_,{type:"selection",width:"55"}),e(_,{prop:"name",label:"评估名称",align:"center"},{default:o(({row:a})=>[c(V(a.scale.name),1)]),_:1}),e(_,{prop:"type",label:"评估类型",align:"center"},{default:o(({row:a})=>[c(V(a.scale_set.name),1)]),_:1}),e(_,{prop:"created_at",label:"评估时间",align:"center"}),e(_,{prop:"results",label:"评估结果",align:"center"})]),_:1},8,["data"]),e(be,{total:t(M),layout:"total, prev, pager, next, jumper",page:t(T).page,"onUpdate:page":l[4]||(l[4]=a=>t(T).page=a),limit:t(T).per_page,"onUpdate:limit":l[5]||(l[5]=a=>t(T).per_page=a),onPagination:X},null,8,["total","page","limit"])]),_:1},8,["modelValue"]),e(Y,{data:t($),border:""},{default:o(()=>[e(_,{type:"index",label:"序号",width:"120",align:"center"}),e(_,{prop:"name",label:"量表名称",align:"center"},{default:o(({row:a})=>[c(V(a.scale.name),1)]),_:1}),e(_,{prop:"score",label:"得分",align:"center"}),e(_,{prop:"type",label:"评估类型",align:"center"},{default:o(({row:a})=>[c(V(a.scale_set.name),1)]),_:1}),e(_,{prop:"created_at",label:"评估时间",align:"center"}),e(_,{prop:"results",label:"结果",align:"center"}),e(_,{prop:"action",label:"操作",align:"center"},{default:o(({row:a})=>[e(h,{type:"primary",plain:"",onClick:y=>ve(a)},{default:o(()=>l[23]||(l[23]=[c("删除")])),_:2,__:[23]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),n("div",al,[n("div",null,[e(S,{"icon-class":"star",class:"svg-icon"}),l[24]||(l[24]=c(" 评估结果 "))])]),e(I,{gutter:63},{default:o(()=>[e(p,{span:12},{default:o(()=>[e(w,{label:"报告类型"},{default:o(()=>[e(b,{modelValue:t(d).scale_set_id,"onUpdate:modelValue":l[7]||(l[7]=a=>t(d).scale_set_id=a),placeholder:"请选择",style:{width:"515px"}},{default:o(()=>[(i(!0),v(x,null,C(t(J),a=>(i(),k(m,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:o(()=>[e(w,{label:"评估结果"},{default:o(()=>[e(b,{modelValue:t(d).final_result,"onUpdate:modelValue":l[8]||(l[8]=a=>t(d).final_result=a),placeholder:"请选择",style:{width:"515px"}},{default:o(()=>[e(m,{value:0,label:"0级能力完好"}),e(m,{value:1,label:"1级轻度失能"}),e(m,{value:2,label:"2级中度失能"}),e(m,{value:3,label:"3级重度失能"}),e(m,{value:4,label:"4级完全失能"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),n("div",tl,[n("div",null,[e(S,{"icon-class":"bar",class:"svg-icon"}),l[25]||(l[25]=c(" 会诊目的 "))])]),e(w,null,{default:o(()=>[e(L,{modelValue:t(d).purpose,"onUpdate:modelValue":l[9]||(l[9]=a=>t(d).purpose=a),type:"textarea",rows:3,placeholder:"请输入会诊目的"},null,8,["modelValue"])]),_:1}),e(I,{gutter:42},{default:o(()=>[e(p,{span:8}),e(p,{span:8}),e(p,{span:8},{default:o(()=>[e(w,null,{default:o(()=>[e(b,{modelValue:t(B),"onUpdate:modelValue":l[10]||(l[10]=a=>F(B)?B.value=a:null),placeholder:"请选择知识库",onChange:ce},{default:o(()=>[(i(!0),v(x,null,C(t(Q),(a,y)=>(i(),k(m,{key:y,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ye,{modelValue:t(D),"onUpdate:modelValue":l[11]||(l[11]=a=>F(D)?D.value=a:null)},{default:o(()=>[e(A,{label:"药物指导",name:"med_guid"}),e(A,{label:"中医证治",name:"tcm_sdt"}),e(A,{label:"医疗护理",name:"med_care"}),e(A,{label:"康复治疗",name:"rehab_ther"}),e(A,{label:"营养膳食",name:"nutri_diet"}),e(A,{label:"心理指导",name:"psy_couns"}),e(A,{label:"运动处方",name:"ex_pres"}),e(A,{label:"生活照顾",name:"daily_care"}),e(A,{label:"专家意见",name:"exo"})]),_:1},8,["modelValue"]),e(w,null,{default:o(()=>[e(L,{modelValue:t(d)[t(D)],"onUpdate:modelValue":l[12]||(l[12]=a=>t(d)[t(D)]=a),type:"textarea",rows:5,placeholder:"请输入药物指导"},null,8,["modelValue"])]),_:1})])]}),_:1})])]),_:1},8,["modelValue"])}}},gl=Ee(nl,[["__scopeId","data-v-465cf59c"]]);export{gl as default};
