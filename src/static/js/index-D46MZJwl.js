import{_ as Ee,d as Te,a as Le,u as Se,r as m,e as n,D as K,c as _,o as d,f as b,h as e,F as y,v as k,x as Q,p as X,t as w,E as Z,A as h,i as t,j as f,H as Ie,I as qe,J as De}from"./index-BCPe6f7k.js";import{a as Ne,g as N}from"./index-BdLHAAwy.js";import{e as Re}from"./baseInfo-CQ1nngzO.js";import{g as Be}from"./epartmene-CB3UALfk.js";import{u as Pe,_ as $e,I as je,g as ze}from"./index-Di06UgDj.js";import{u as Fe}from"./elder-DaZm3efB.js";/* empty css                                                              */import"./building-BOFBaH5z.js";const Oe={class:"aside-bar"},Me={class:"type-wrapper"},Ye=["onClick"],Je={class:"aside-content"},We={class:"search-bar"},He={class:"elder-list hide-scrollbar"},Ge=["onClick"],Ke={class:"pagination"},Qe={class:"total"},Xe={class:"pager"},Ze={class:"page"},el={class:"title"},ll={class:"dialog-footer"},al={__name:"index",setup(tl){const{socket:ee,isConnected:le,send:ae,connect:te}=Pe(),{proxy:x}=Te();Le(),Se();const U=Fe(),p=m({keyword:"",epartmene_id:"",page:1,per_page:20}),R=m(0),oe=m([{label:"未入住",value:0},{label:"已入住",value:1}]),ue=(u,a)=>{U.setStatus(u.value),A()},L=m([]),B=m(!1),M=m(-1),A=async()=>{var a;B.value=!0;const u=await Ne({...p.value,status:U.status});B.value=!1,L.value=u.data.data,R.value=u.data.total,u.data.total>0?(a=U.elder)!=null&&a.id?I(U.elder,L.value.findIndex(g=>g.id===U.elder.id)):I(u.data.data[0],0):I(null,-1)};A();const P=m([]),S=async()=>{const u=await Be();P.value=u.data};S();const I=(u,a)=>{U.setElder(u),M.value=a},ne=()=>{p.value.page>1&&(p.value.page--,S())},se=()=>{p.value.page*p.value.per_page<R.value&&(p.value.page++,S())},de=u=>{p.value.per_page=parseInt(u),p.value.page=1,S()},re=m(null),o=m({avatar:"",name:"",sex:"",date_birth:"",nation:"",id_code:"",address:"",status:"",marital_status:"",phone:"",height:"",weight:"",educational:"",religious:"",live_situation:[],payment_method:[],economic_sources:[],form:"",epartmene_id:"",building_id:"",floor:"",room_id:"",bed_id:""}),ie={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"change"}],date_birth:[{required:!0,message:"请选择出生日期",trigger:"change"}],nation:[{required:!0,message:"请选择民族",trigger:"change"}],id_code:[{required:!0,message:"请输入身份证号码",trigger:"blur"}],address:[{required:!0,message:"请输入地址",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"}],form:[{required:!0,message:"请选择数据来源",trigger:"change"}]},Y=m([]),pe=async()=>{const u=await N({key:"elder_form"});Y.value=u.data.elder_form},J=m([]),me=async()=>{const u=await N({key:"crs"});J.value=u.data.crs},W=m([]),ve=async()=>{const u=await N({key:"mepm"});W.value=u.data.mepm},H=m([]),_e=async()=>{const u=await N({key:"soi"});H.value=u.data.soi},G=()=>{Object.keys(o.value).forEach(u=>{o.value[u]=""}),o.value.live_situation=[],o.value.payment_method=[],o.value.economic_sources=[],x.resetForm("formRef")},E=m(!1),ce=async()=>{te(),ee.value.onmessage=async u=>{const a=JSON.parse(u.data);let g="";if(a.Ret==0){if(a.Cmd==10001){g=JSON.parse(window.atob(a.UserParam)),x.$modal.msgSuccess("读取身份证成功");const{PhotoDisplay:r,cName:V,cNo:c,cSex:$,cBirthday:j,cNation:q,cAddress:z}=ze(g);if(r){const T=await Ie(r);try{const D=await qe(T);o.value.avatar=D.data.path}catch{x.$modal.msgError("头像获取失败,请手动上传")}}o.value.name=V,o.value.id_code=c,o.value.sex=$,o.value.date_birth=j,o.value.nation=q,o.value.address=z}}else De.confirm("读卡失败："+a.ErrInfo,"系统提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{}).catch(()=>{})},await G(),await pe(),await me(),await ve(),await _e(),E.value=!0},fe=()=>{if(!le.value){x.$modal.msgError("WebSocket 连接异常,请刷新页面重试!");return}ae(je)},ge=()=>{E.value=!1,G()},be=()=>{x.$refs.formRef.validate(async u=>{u&&(await Re({...o.value,live_situation:o.value.live_situation.join(","),payment_method:o.value.payment_method.join(","),economic_sources:o.value.economic_sources.join(",")}),x.$modal.msgSuccess("新增成功"),E.value=!1,A())})};return(u,a)=>{const g=n("el-button"),r=n("el-option"),V=n("el-select"),c=n("el-input"),$=n("el-empty"),j=n("ArrowLeft"),q=n("el-icon"),z=n("ArrowRight"),T=n("el-dropdown-item"),D=n("el-dropdown-menu"),Ve=n("el-dropdown"),ye=n("svg-icon"),ke=n("ImageUpload"),s=n("el-form-item"),i=n("el-col"),we=n("el-date-picker"),C=n("el-row"),F=n("el-checkbox"),O=n("el-checkbox-group"),he=n("el-form"),Ue=n("Dialog"),Ce=K("hasPermi"),xe=K("loading");return d(),_("div",Oe,[b("div",Me,[(d(!0),_(y,null,k(oe.value,(l,v)=>(d(),_("div",{class:Q(["item",{active:X(U).status==l.value}]),key:v,onClick:Ae=>ue(l)},w(l.label),11,Ye))),128))]),b("div",Je,[b("div",We,[Z((d(),h(g,{type:"primary",icon:"plus",plain:"",class:"add-btn",onClick:ce},{default:t(()=>a[25]||(a[25]=[f("新增长者")])),_:1,__:[25]})),[[Ce,["POST.elder"]]]),e(V,{class:"search-select",modelValue:p.value.epartmene_id,"onUpdate:modelValue":a[0]||(a[0]=l=>p.value.epartmene_id=l),placeholder:"请选择所属科室",clearable:"",onChange:A},{default:t(()=>[(d(!0),_(y,null,k(P.value,l=>(d(),h(r,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(c,{modelValue:p.value.keyword,"onUpdate:modelValue":a[1]||(a[1]=l=>p.value.keyword=l),placeholder:"请输入老人姓名"},{append:t(()=>[e(g,{icon:"search",onClick:A})]),_:1},8,["modelValue"])]),Z((d(),_("div",He,[L.value.length>0?(d(!0),_(y,{key:0},k(L.value,(l,v)=>(d(),_("div",{class:Q(["elder-item",{active:M.value==v}]),key:v,onClick:Ae=>I(l,v)},w(l.name),11,Ge))),128)):(d(),h($,{key:1,"image-size":50,description:"暂无数据"}))])),[[xe,B.value]]),b("div",Ke,[b("div",Qe,"共"+w(R.value)+"条",1),b("div",Xe,[e(q,{size:"8",onClick:ne},{default:t(()=>[e(j)]),_:1}),b("div",Ze,w(p.value.page),1),e(q,{size:"8",onClick:se},{default:t(()=>[e(z)]),_:1})]),e(Ve,{placement:"top-start",onCommand:de},{dropdown:t(()=>[e(D,null,{default:t(()=>[e(T,{command:"20"},{default:t(()=>a[26]||(a[26]=[f("20条/页")])),_:1,__:[26]}),e(T,{command:"50"},{default:t(()=>a[27]||(a[27]=[f("50条/页")])),_:1,__:[27]}),e(T,{command:"100"},{default:t(()=>a[28]||(a[28]=[f("100条/页")])),_:1,__:[28]})]),_:1})]),default:t(()=>[e(g,{size:"small",class:"siges"},{default:t(()=>[f(w(p.value.per_page)+"条/页 ",1)]),_:1})]),_:1})])]),e(Ue,{modelValue:E.value,"onUpdate:modelValue":a[24]||(a[24]=l=>E.value=l),title:"新增长者"},{footer:t(()=>[b("div",ll,[e(g,{onClick:ge},{default:t(()=>a[30]||(a[30]=[f("取消")])),_:1,__:[30]}),e(g,{type:"primary",onClick:be},{default:t(()=>a[31]||(a[31]=[f(" 保存 ")])),_:1,__:[31]})])]),default:t(()=>[e(he,{model:o.value,rules:ie,ref_key:"formRef",ref:re,"label-position":"top"},{default:t(()=>[b("div",el,[e(ye,{"icon-class":"box",class:"svg-icon"}),a[29]||(a[29]=f(" 基础信息 "))]),e(C,{gutter:26},{default:t(()=>[e(i,{span:6},{default:t(()=>[e(s,{label:"照片",prop:"avatar"},{default:t(()=>[e(ke,{modelValue:o.value.avatar,"onUpdate:modelValue":a[2]||(a[2]=l=>o.value.avatar=l),limit:1,isShowTip:!1},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:t(()=>[e(s,{label:"姓名",prop:"name"},{default:t(()=>[e(c,{modelValue:o.value.name,"onUpdate:modelValue":a[3]||(a[3]=l=>o.value.name=l),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(s,{label:"出生日期",prop:"date_birth"},{default:t(()=>[e(we,{style:{width:"100%"},modelValue:o.value.date_birth,"onUpdate:modelValue":a[4]||(a[4]=l=>o.value.date_birth=l),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择出生日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:t(()=>[e(s,{label:"性别",prop:"sex"},{default:t(()=>[e(V,{modelValue:o.value.sex,"onUpdate:modelValue":a[5]||(a[5]=l=>o.value.sex=l),placeholder:"请选择性别"},{default:t(()=>[e(r,{label:"男",value:1}),e(r,{label:"女",value:2})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"身高(cm)",prop:"height"},{default:t(()=>[e(c,{modelValue:o.value.height,"onUpdate:modelValue":a[6]||(a[6]=l=>o.value.height=l),type:"number",placeholder:"请输入身高"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:t(()=>[e(s,{label:"身份证号",prop:"id_code"},{default:t(()=>[e(c,{modelValue:o.value.id_code,"onUpdate:modelValue":a[7]||(a[7]=l=>o.value.id_code=l),placeholder:"请输入身份证号"},{append:t(()=>[b("span",{style:{cursor:"pointer"},onClick:fe},"读卡")]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"体重(kg)",prop:"weight"},{default:t(()=>[e(c,{modelValue:o.value.weight,"onUpdate:modelValue":a[8]||(a[8]=l=>o.value.weight=l),type:"number",placeholder:"请输入体重"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:26},{default:t(()=>[e(i,{span:6},{default:t(()=>[e(s,{label:"手机号",prop:"phone"},{default:t(()=>[e(c,{modelValue:o.value.phone,"onUpdate:modelValue":a[9]||(a[9]=l=>o.value.phone=l),type:"number",placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:t(()=>[e(s,{label:"户籍地址",prop:"address"},{default:t(()=>[e(c,{modelValue:o.value.address,"onUpdate:modelValue":a[10]||(a[10]=l=>o.value.address=l),placeholder:"请输入户籍地址"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:t(()=>[e(s,{label:"类型",prop:"form"},{default:t(()=>[e(V,{modelValue:o.value.form,"onUpdate:modelValue":a[11]||(a[11]=l=>o.value.form=l),placeholder:"请选择类型"},{default:t(()=>[(d(!0),_(y,null,k(Y.value,(l,v)=>(d(),h(r,{key:v,label:l.value,value:l.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:t(()=>[e(s,{label:"所属科室",prop:"epartmene_id"},{default:t(()=>[e(V,{modelValue:o.value.epartmene_id,"onUpdate:modelValue":a[12]||(a[12]=l=>o.value.epartmene_id=l),placeholder:"请选择所属科室"},{default:t(()=>[(d(!0),_(y,null,k(P.value,l=>(d(),h(r,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:26},{default:t(()=>[e(i,{span:6},{default:t(()=>[e(s,{label:"状态",prop:"status"},{default:t(()=>[e(V,{modelValue:o.value.status,"onUpdate:modelValue":a[13]||(a[13]=l=>o.value.status=l),placeholder:"请选择状态"},{default:t(()=>[e(r,{label:"未入住",value:0}),e(r,{label:"已入住",value:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:t(()=>[e(s,{label:"床位",prop:"bed_id"},{default:t(()=>[e(X($e),{level1:o.value.building_id,"onUpdate:level1":a[14]||(a[14]=l=>o.value.building_id=l),level2:o.value.room_id,"onUpdate:level2":a[15]||(a[15]=l=>o.value.room_id=l),level3:o.value.bed_id,"onUpdate:level3":a[16]||(a[16]=l=>o.value.bed_id=l)},null,8,["level1","level2","level3"])]),_:1})]),_:1}),e(i,{span:6},{default:t(()=>[e(s,{label:"文化程度",prop:"educational"},{default:t(()=>[e(V,{modelValue:o.value.educational,"onUpdate:modelValue":a[17]||(a[17]=l=>o.value.educational=l),placeholder:"请选择文化程度"},{default:t(()=>[e(r,{label:"小学",value:"小学"}),e(r,{label:"初中",value:"初中"}),e(r,{label:"高中/中专",value:"高中/中专"}),e(r,{label:"大专",value:"大专"}),e(r,{label:"本科",value:"本科"}),e(r,{label:"硕士",value:"硕士"}),e(r,{label:"博士",value:"博士"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:t(()=>[e(s,{label:"婚姻状况",prop:"marital_status"},{default:t(()=>[e(V,{modelValue:o.value.marital_status,"onUpdate:modelValue":a[18]||(a[18]=l=>o.value.marital_status=l),placeholder:"请选择婚姻状况"},{default:t(()=>[e(r,{label:"已婚",value:"已婚"}),e(r,{label:"未婚",value:"未婚"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:26},{default:t(()=>[e(i,{span:12},{default:t(()=>[e(s,{label:"民族",prop:"nation"},{default:t(()=>[e(c,{modelValue:o.value.nation,"onUpdate:modelValue":a[19]||(a[19]=l=>o.value.nation=l),placeholder:"请填写少数民族"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:t(()=>[e(s,{label:"宗教信仰",prop:"religious"},{default:t(()=>[e(c,{modelValue:o.value.religious,"onUpdate:modelValue":a[20]||(a[20]=l=>o.value.religious=l),placeholder:"请填写宗教信仰"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:26},{default:t(()=>[e(i,{span:24},{default:t(()=>[e(s,{label:"居住情况(多选）",prop:"live_situation"},{default:t(()=>[e(O,{modelValue:o.value.live_situation,"onUpdate:modelValue":a[21]||(a[21]=l=>o.value.live_situation=l)},{default:t(()=>[(d(!0),_(y,null,k(J.value,(l,v)=>(d(),h(F,{key:v,value:l.key,name:l.value},{default:t(()=>[f(w(l.value),1)]),_:2},1032,["value","name"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:26},{default:t(()=>[e(i,{span:24},{default:t(()=>[e(s,{label:"医疗费用支付方式(多选）",prop:"payment_method"},{default:t(()=>[e(O,{modelValue:o.value.payment_method,"onUpdate:modelValue":a[22]||(a[22]=l=>o.value.payment_method=l)},{default:t(()=>[(d(!0),_(y,null,k(W.value,(l,v)=>(d(),h(F,{key:v,value:l.key,name:l.value},{default:t(()=>[f(w(l.value),1)]),_:2},1032,["value","name"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:26},{default:t(()=>[e(i,{span:24},{default:t(()=>[e(s,{label:"经济来源(多选）",prop:"economic_sources"},{default:t(()=>[e(O,{modelValue:o.value.economic_sources,"onUpdate:modelValue":a[23]||(a[23]=l=>o.value.economic_sources=l)},{default:t(()=>[(d(!0),_(y,null,k(H.value,(l,v)=>(d(),h(F,{key:v,value:l.key,name:l.value},{default:t(()=>[f(w(l.value),1)]),_:2},1032,["value","name"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ml=Ee(al,[["__scopeId","data-v-05171150"]]);export{ml as default};
