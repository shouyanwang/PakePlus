import{_ as j,a as z,b as M,c as U}from"./dashboard_4-C_LFPXOZ.js";import{E as $,h as J}from"./jspdf.es.min-DaAeb2LW.js";import{a as O}from"./index-CY7xaJsh.js";import{_ as Q,d as Y,r as x,w as q,e as u,A as L,o as d,i as m,f as t,t as c,p as s,h as a,j as g,c as _,F as K,v as X,B as v,Q as Z,R as tt}from"./index-BCPe6f7k.js";const et={class:"report-view-title"},st={class:"user-wrap"},ot={class:"username"},at={class:"text"},lt={class:"info-wrap"},it={class:"info-item"},nt={class:"value"},rt={class:"info-item"},dt={class:"value"},ct={class:"info-item"},_t={class:"value"},pt={class:"info-item"},ut={class:"value"},mt={class:"doctor-wrap"},vt={class:"doctor-title"},gt={class:"doctor-info"},ft={class:"black"},ht={class:"doctor-title"},bt={class:"dot-result"},wt={class:"value"},yt={class:"doctor-title"},kt={class:"warn-wrap"},Vt={class:"doctor-title"},xt={class:"status-wrap"},Ct={key:0,class:"status-img",src:j,alt:""},Ft={key:1,class:"status-img",src:z,alt:""},Dt={key:2,class:"status-img",src:M,alt:""},Rt={key:3,class:"status-img",src:U,alt:""},Pt={class:"status-text"},Bt={key:0},Et={key:1},It={key:2},Lt={key:3},Nt={key:4},Tt={class:"dialog-footer"},At={__name:"ViewReport",props:{modelValue:{type:Boolean,default:!1},id:{type:Number,default:""}},emits:["update:modelValue"],setup(N,{expose:T,emit:A}){const{proxy:P}=Y(),C=N,H=A,y=x(C.modelValue),o=x({}),B=x([]),S=async()=>{const l=await O({id:C.id});B.value=[{name:l.data.report.scale_result.name,type:l.data.report.scale_result.scale_set.name,updated_at:l.data.report.updated_at,score:l.data.report.scale_result.score,results:l.data.report.scale_result.results}],o.value=l.data};q(()=>C.modelValue,async l=>{l==!0&&(P.$modal.loading("加载中..."),await S(),P.$modal.closeLoading()),y.value=l});const G=()=>{H("update:modelValue",!1)},W={"-1":"老人能力等级划分",0:"综合评估报告",30:"老年护理需求等级评定",29:"老年综合评估（CGA）",31:"老年康复综合评估（RCGA）"},E=x(null),I=async()=>{const l=tt.service({lock:!0,text:"正在生成PDF，请稍候..."}),e=E.value,i=new $({orientation:"p",unit:"mm",format:"a4"}),k=i.internal.pageSize.getHeight(),F=i.internal.pageSize.getWidth(),f=15,b=k-2*f,n=await J(e,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#FFFFFF",scrollY:0}),r=F-2*f,D=n.height*r/n.width,R=Math.ceil(D/b);for(let p=0;p<R;p++){p>0&&i.addPage();const w=p*b*(n.width/r),h=Math.min(b*(n.width/r),n.height-w),V=document.createElement("canvas");V.width=n.width,V.height=h,V.getContext("2d").drawImage(n,0,w,n.width,h,0,0,n.width,h),i.addImage(V.toDataURL("image/jpeg",.95),"JPEG",f,f,r,h*(r/n.width))}window.open(i.output("bloburl")),l.close()};return T({generatePDF:I}),(l,e)=>{const i=u("svg-icon"),k=u("el-button"),F=u("el-form-item"),f=u("el-col"),b=u("el-row"),n=u("el-form"),r=u("el-table-column"),D=u("el-table"),R=u("Dialog");return d(),L(R,{modelValue:s(y),"onUpdate:modelValue":e[0]||(e[0]=p=>Z(y)?y.value=p:null),width:"1205",title:"查看报告",onClose:G},{footer:m(()=>[t("div",Tt,[a(k,{type:"primary",onClick:I},{default:m(()=>e[12]||(e[12]=[g("打印报告")])),_:1,__:[12]})])]),default:m(()=>{var p;return[t("div",{ref_key:"elementToPrint",ref:E,class:"report-view"},[t("div",et,c(W[s(o).type]),1),t("div",st,[t("div",ot,[t("div",at,[a(i,{"icon-class":"user-2",class:"svg-icon"}),g(" "+c((p=s(o).elder)==null?void 0:p.name),1)]),a(k,{type:"primary",round:""},{default:m(()=>[g(c(l.statusFormat(s(o).elder.status)),1)]),_:1})]),t("div",lt,[t("div",it,[e[1]||(e[1]=t("div",{class:"label"},"年龄",-1)),t("div",nt,c(s(o).elder.age),1)]),t("div",rt,[e[2]||(e[2]=t("div",{class:"label"},"性别",-1)),t("div",dt,c(l.genderFormat(s(o).elder.sex)),1)]),t("div",ct,[e[3]||(e[3]=t("div",{class:"label"},"科别",-1)),t("div",_t,c(s(o).elder.epartmene.name),1)]),t("div",pt,[e[4]||(e[4]=t("div",{class:"label"},"床位号",-1)),t("div",ut,c(s(o).elder.building.name)+"/"+c(s(o).elder.room.name)+"/"+c(s(o).elder.bed.name),1)])])]),t("div",mt,[t("div",vt,[a(i,{"icon-class":"doctor",class:"svg-icon"}),e[5]||(e[5]=g(" 医药师 "))]),t("div",gt,[a(n,{"label-width":"120"},{default:m(()=>[a(b,null,{default:m(()=>[(d(!0),_(K,null,X(s(o).participant,(w,h)=>(d(),L(f,{key:h,span:6},{default:m(()=>[a(F,{label:w.role},{default:m(()=>[t("div",ft,c(w.user),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1})]),t("div",ht,[a(i,{"icon-class":"star",class:"svg-icon"}),e[6]||(e[6]=g(" 评估量表得分 "))]),a(D,{data:s(B),border:""},{default:m(()=>[a(r,{type:"index",label:"序号",align:"center"}),a(r,{prop:"name",label:"量表名称",align:"center"}),a(r,{prop:"score",label:"得分",align:"center"}),a(r,{prop:"type",label:"评估类型",align:"center"}),a(r,{prop:"updated_at",label:"评估时间",align:"center"}),a(r,{prop:"results",label:"结果",align:"center"})]),_:1},8,["data"]),t("div",bt,[e[7]||(e[7]=t("div",{class:"label"},"评估类型",-1)),t("div",wt,c(s(o).scale_set.name),1)]),t("div",yt,[t("div",null,[a(i,{"icon-class":"medal",class:"svg-icon"}),e[8]||(e[8]=g(" 老人能力等级划分标准 "))])]),e[11]||(e[11]=t("div",{class:"assess-list"},[t("div",{class:"title"}," 有以下情况之一者,在原有能力级别上应提高一个级别: "),t("div",{class:"assess-item"},[t("div",{class:"label"},"1.确诊为痴呆")]),t("div",{class:"assess-item"},[t("div",{class:"label"}," 2.精神科专科医生诊断的其他精神和行为障碍疾病 ")]),t("div",{class:"assess-item"},[t("div",{class:"label"}," 3.近 30天内发生过2次及以上照护风险事件(如跌倒、噎食自杀、自伤、走失等)。 ")])],-1)),t("div",kt,[a(i,{"icon-class":"warn",class:"svg-icon"}),e[9]||(e[9]=g(" 处于昏迷状态者,直接评定为能力完全丧失(完全失能)。 "))]),t("div",Vt,[t("div",null,[a(i,{"icon-class":"triangle",class:"svg-icon"}),e[10]||(e[10]=g(" 最终老人能力等级 "))])]),t("div",xt,[s(o).report.final_result==0||s(o).report.final_result==1?(d(),_("img",Ct)):v("",!0),s(o).report.final_result==2?(d(),_("img",Ft)):v("",!0),s(o).report.final_result==3?(d(),_("img",Dt)):v("",!0),s(o).report.final_result==4?(d(),_("img",Rt)):v("",!0),t("div",Pt,[s(o).report.final_result==0?(d(),_("span",Bt,"0级能力完好")):v("",!0),s(o).report.final_result==1?(d(),_("span",Et,"1级轻度失能")):v("",!0),s(o).report.final_result==2?(d(),_("span",It,"2级中度失能")):v("",!0),s(o).report.final_result==3?(d(),_("span",Lt,"3级重度失能")):v("",!0),s(o).report.final_result==4?(d(),_("span",Nt,"4级完全失能")):v("",!0)])])])],512)]}),_:1},8,["modelValue"])}}},zt=Q(At,[["__scopeId","data-v-dd82c2d1"]]);export{zt as default};
