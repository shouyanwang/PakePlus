import{_ as re,d as ue,a as ce,r as p,w as _e,e as u,A as g,o as n,i as s,f as t,h as a,c as _,F as V,v as k,p as o,x as me,t as m,j as i,O as pe}from"./index-gubRP18q.js";import{p as ve}from"./index-DBh5LrMf.js";import{a as fe}from"./index-TvOLbabI.js";import{g as ge}from"./baseInfo-Bb6YRiDG.js";import{g as ye}from"./epartmene-D2Rd6sgX.js";import{g as be}from"./roles-Cdu4wKiR.js";import{g as we}from"./user-D8WAOQH1.js";import{g as Ve}from"./scaleSet-MWCuoDeT.js";import{b as ke}from"./index-DflO1dAi.js";import{u as Ae}from"./elder-DBu0Okgw.js";const Ce={class:"report-view"},xe={class:"user-wrap"},Ee={class:"form-box"},Se={class:"type-wrap"},$e=["onClick"],De={class:"info-wrap"},Re={class:"info-item"},Ue={class:"value"},ze={class:"info-item"},We={key:0,class:"value"},Be={key:1,class:"value"},Le={class:"info-item"},je={class:"value"},Fe={class:"info-item"},Ie={key:0,class:"value"},Ne={key:1},Te={class:"doctor-wrap"},qe={class:"doctor-title"},Oe={class:"doctor-title"},Pe={key:0},Ge={class:"flex-center"},He={class:"doctor-title"},Je={class:"warn-wrap"},Ke={class:"doctor-title"},Me={class:"dialog-footer"},Qe={__name:"AddReport",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(H,{emit:J}){const{proxy:v}=ue(),K=Ae(),M=ce(),L=H,j=J,y=p(L.modelValue);_e(()=>L.modelValue,async d=>{d==!0&&(v.$modal.loading("加载中..."),await Y(),await z(),await h(),await ee()),v.$modal.closeLoading(),y.value=d});const Q=()=>{j("update:modelValue",!1)};p(!1);const r=p({elder_id:"",scale_set_id:"",type:"-1",result_ids:"",final_result:""}),A=p({status:1,epartmene_id:"",page:1,per_page:1e3}),X=p([{name:"已入住",value:1},{name:"未入住",value:0}]),F=p([]),Y=async()=>{const d=await ye();F.value=d.data},c=p({}),C=p([]),I=async()=>{if(r.value.elder_id){c.value;const d=await ge({id:r.value.elder_id});c.value=d.data;const e=await ke({id:r.value.elder_id,type:"-1"});e.data!=null?C.value=[e.data]:C.value=[{id:"",scale_set_id:"",name:"",score:"",result:"",status:"",created_at:"",scale_set:{id:"",name:""}}]}else c.value={}},N=p([]),z=async()=>{r.value.elder_id="",await I();const d=await fe(A.value);N.value=d.data.data},Z=(d,e)=>{A.value.status=d.value,z()},x=p([]),h=async()=>{const d=await be({is_ca:1});x.value=d.data,x.value.forEach(async e=>{const{data:b}=await we({role_id:e.id});e.option=b})},T=p([]),ee=async()=>{const d=await Ve();T.value=d.data},le=async()=>{K.setElder(c.value),M.push("/workstation/project?type=2&title=老人能力评估")},te=()=>{y.value=!1},ae=async()=>{if(!r.value.elder_id){v.$modal.msgWarning("请选择长者");return}for(const e of x.value)if(!e.select){v.$modal.msgWarning("请选择医药师");return}const d=x.value.map(e=>({role_id:e.id,user_id:e.select}));if(C.value.filter(e=>e.id).length==0){v.$modal.msgWarning("请选择评估量表");return}if(!r.value.scale_set_id){v.$modal.msgWarning("请填写报告类型");return}if(r.value.final_result==""){v.$modal.msgWarning("请填写最终老人能力等级");return}await ve({...r.value,type:"-1",participant:d,result_ids:C.value.map(e=>e.id).join(",")}),v.$modal.msgSuccess("添加成功"),y.value=!1,j("success")};return(d,e)=>{const b=u("el-col"),D=u("el-option"),R=u("el-select"),W=u("el-form-item"),q=u("el-row"),E=u("svg-icon"),w=u("el-table-column"),B=u("el-button"),se=u("el-table"),S=u("el-radio"),oe=u("el-radio-group"),ne=u("el-form"),de=u("Dialog");return n(),g(de,{modelValue:o(y),"onUpdate:modelValue":e[4]||(e[4]=U=>pe(y)?y.value=U:null),width:"1205",title:"新增报告",onClose:Q},{footer:s(()=>[t("div",Me,[a(B,{onClick:te},{default:s(()=>e[23]||(e[23]=[i("取消")])),_:1,__:[23]}),a(B,{type:"primary",onClick:ae},{default:s(()=>e[24]||(e[24]=[i(" 保存 ")])),_:1,__:[24]})])]),default:s(()=>[t("div",Ce,[e[22]||(e[22]=t("div",{class:"report-view-title"},"老人能力等级划分",-1)),a(ne,{"label-position":"top"},{default:s(()=>{var U,O,P,G;return[t("div",xe,[t("div",Ee,[a(q,{gutter:42},{default:s(()=>[a(b,{span:8},{default:s(()=>[t("div",Se,[(n(!0),_(V,null,k(o(X),(l,f)=>(n(),_("div",{class:me(["type-item",{active:o(A).status==l.value}]),key:f,onClick:$=>Z(l,f)},m(l.name),11,$e))),128))])]),_:1}),a(b,{span:8},{default:s(()=>[a(W,null,{default:s(()=>[a(R,{modelValue:o(A).epartmene_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o(A).epartmene_id=l),placeholder:"请选择所属科室",onChange:z},{default:s(()=>[(n(!0),_(V,null,k(o(F),(l,f)=>(n(),g(D,{key:f,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(b,{span:8},{default:s(()=>[a(W,null,{default:s(()=>[a(R,{modelValue:o(r).elder_id,"onUpdate:modelValue":e[1]||(e[1]=l=>o(r).elder_id=l),placeholder:"请选择长者",onChange:I},{default:s(()=>[(n(!0),_(V,null,k(o(N),(l,f)=>(n(),g(D,{key:f,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),t("div",De,[t("div",Re,[e[5]||(e[5]=t("div",{class:"label"},"年龄",-1)),t("div",Ue,m(o(c).age||"--"),1)]),t("div",ze,[e[6]||(e[6]=t("div",{class:"label"},"性别",-1)),o(c).sex?(n(),_("div",We,m(d.genderFormat(o(c).sex)||"--"),1)):(n(),_("div",Be,"--"))]),t("div",Le,[e[7]||(e[7]=t("div",{class:"label"},"科别",-1)),t("div",je,m(((U=o(c).epartmene)==null?void 0:U.name)||"--"),1)]),t("div",Fe,[e[8]||(e[8]=t("div",{class:"label"},"床位号",-1)),o(c).bed?(n(),_("div",Ie,m((O=o(c).building)==null?void 0:O.name)+"/ "+m((P=o(c).room)==null?void 0:P.name)+"/ "+m((G=o(c).bed)==null?void 0:G.name),1)):(n(),_("div",Ne,"--"))])])]),t("div",Te,[t("div",qe,[t("div",null,[a(E,{"icon-class":"doctor",class:"svg-icon"}),e[9]||(e[9]=i(" 选择医药师 "))])]),a(q,{gutter:63},{default:s(()=>[(n(!0),_(V,null,k(o(x),(l,f)=>(n(),g(b,{span:12,key:f},{default:s(()=>[a(W,{label:l.name},{default:s(()=>[a(R,{modelValue:l.select,"onUpdate:modelValue":$=>l.select=$,placeholder:"请选择"},{default:s(()=>[(n(!0),_(V,null,k(l.option,($,ie)=>(n(),g(D,{key:ie,label:$.name,value:$.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),t("div",Oe,[t("div",null,[a(E,{"icon-class":"star",class:"svg-icon"}),e[10]||(e[10]=i(" 各评估量表得分 "))])]),a(se,{data:o(C),border:""},{default:s(()=>[a(w,{type:"index",label:"序号",width:"120",align:"center"}),a(w,{prop:"name",label:"量表名称",align:"center"},{default:s(({row:l})=>[i(m(l.name||"--"),1)]),_:1}),a(w,{prop:"score",label:"得分",align:"center"},{default:s(({row:l})=>[i(m(l.score||"--"),1)]),_:1}),a(w,{prop:"type",label:"评估类型",align:"center"},{default:s(({row:l})=>[i(m(l.scale_set.name||"--"),1)]),_:1}),a(w,{prop:"created_at",label:"评估时间",align:"center"},{default:s(({row:l})=>[i(m(l.scale_set.name||"--"),1)]),_:1}),a(w,{prop:"result",label:"结果",align:"center"},{default:s(({row:l})=>[l.id?(n(),_("span",Pe,m(l.result),1)):(n(),g(B,{key:1,type:"primary",plain:"",onClick:le},{default:s(()=>e[11]||(e[11]=[i("立即评估")])),_:1,__:[11]}))]),_:1})]),_:1},8,["data"]),t("div",Ge,[e[12]||(e[12]=t("div",{class:"sub-title"},"报告类型",-1)),a(R,{modelValue:o(r).scale_set_id,"onUpdate:modelValue":e[2]||(e[2]=l=>o(r).scale_set_id=l),placeholder:"请选择",style:{width:"515px"}},{default:s(()=>[(n(!0),_(V,null,k(o(T),l=>(n(),g(D,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",He,[t("div",null,[a(E,{"icon-class":"medal",class:"svg-icon"}),e[13]||(e[13]=i(" 老人能力等级划分标准 "))])]),e[21]||(e[21]=t("div",{class:"assess-list"},[t("div",{class:"title"}," 有以下情况之一者,在原有能力级别上应提高一个级别: "),t("div",{class:"assess-item"},[t("div",{class:"label"},"1.确诊为痴呆")]),t("div",{class:"assess-item"},[t("div",{class:"label"}," 2.精神科专科医生诊断的其他精神和行为障碍疾病 ")]),t("div",{class:"assess-item"},[t("div",{class:"label"}," 3.近 30天内发生过2次及以上照护风险事件(如跌倒、噎食自杀、自伤、走失等)。 ")])],-1)),t("div",Je,[a(E,{"icon-class":"warn",class:"svg-icon"}),e[14]||(e[14]=i(" 处于昏迷状态者,直接评定为能力完全丧失(完全失能)。 "))]),t("div",Ke,[t("div",null,[a(E,{"icon-class":"triangle",class:"svg-icon"}),e[15]||(e[15]=i(" 最终老人能力等级 "))])]),a(oe,{modelValue:o(r).final_result,"onUpdate:modelValue":e[3]||(e[3]=l=>o(r).final_result=l)},{default:s(()=>[a(S,{value:0,size:"large"},{default:s(()=>e[16]||(e[16]=[i("0级能力完好")])),_:1,__:[16]}),a(S,{value:1,size:"large"},{default:s(()=>e[17]||(e[17]=[i("1级轻度失能")])),_:1,__:[17]}),a(S,{value:2,size:"large"},{default:s(()=>e[18]||(e[18]=[i("2级中度失能")])),_:1,__:[18]}),a(S,{value:3,size:"large"},{default:s(()=>e[19]||(e[19]=[i("3级重度失能")])),_:1,__:[19]}),a(S,{value:4,size:"large"},{default:s(()=>e[20]||(e[20]=[i("4级完全失能")])),_:1,__:[20]})]),_:1},8,["modelValue"])])]}),_:1})])]),_:1},8,["modelValue"])}}},nl=re(Qe,[["__scopeId","data-v-1198c937"]]);export{nl as default};
