import{r as C,L as y,J as N,z as v,M as h,w as S,e as B,A as m,o as V}from"./index-v815L3Uz.js";import{g as D,a as P,b as p}from"./building-Dl0kPi7E.js";function j(){const e=C(null),l=C(!1),n=C(null),a=C(null),i=()=>{e.value=new WebSocket("ws://127.0.0.1:30004/ws"),e.value.onopen=()=>{l.value=!0,console.log("WebSocket connected")},e.value.onmessage=w=>{n.value=JSON.parse(w.data)},e.value.onerror=w=>{a.value=w,l.value=!1,console.error("WebSocket error:",w),N.confirm("websocket 连接失败,将无法使用读卡功能,请选择是否尝试重新连接?","系统提示",{confirmButtonText:"重新连接",cancelButtonText:"取消",type:"warning"}).then(()=>{s(),i()}).catch(()=>{s()})},e.value.onclose=()=>{l.value=!1,console.log("WebSocket disconnected")}},r=w=>{e.value&&l.value&&e.value.send(JSON.stringify(w))},s=()=>{e.value&&e.value.close()};return y(()=>{s()}),{socket:e,isConnected:l,message:n,error:a,connect:i,send:r,disconnect:s}}const o=e=>{for(var l="",n=0;n<e.length&&e.substr(n,2)!=="00";n+=2){var a=e.charCodeAt(n),i=e.charCodeAt(n+1),r=i*256+a;l+=String.fromCharCode(r)}return l.toString()},O=e=>{if(!e)return null;const l=e.includes("-")?e:`${e.substr(0,4)}-${e.substr(4,2)}-${e.substr(6,2)}`,n=new Date(l),a=new Date;let i=a.getFullYear()-n.getFullYear();const r=a.getMonth()-n.getMonth();return(r<0||r===0&&a.getDate()<n.getDate())&&i--,i},k=e=>{const l=e.substring(0,4),n=e.substring(4,6),a=e.substring(6,8);return`${l}-${n}-${a}`},A={"01":"汉族","02":"蒙古族","03":"回族","04":"藏族","05":"维吾尔族","06":"苗族","07":"彝族","08":"壮族","09":"布依族",10:"朝鲜族",11:"满族",12:"侗族",13:"瑶族",14:"白族",15:"土家族",16:"哈尼族",17:"哈萨克族",18:"傣族",19:"黎族",20:"傈僳族",21:"佤族",22:"畲族",23:"高山族",24:"拉祜族",25:"水族",26:"东乡族",27:"纳西族",28:"景颇族",29:"柯尔克孜族",30:"土族",31:"达斡尔族",32:"仫佬族",33:"羌族",34:"布朗族",35:"撒拉族",36:"毛南族",37:"仡佬族",38:"锡伯族",39:"阿昌族",40:"普米族",41:"塔吉克族",42:"怒族",43:"乌孜别克族",44:"俄罗斯族",45:"鄂温克族",46:"德昂族",47:"保安族",48:"裕固族",49:"京族",50:"塔塔尔族",51:"独龙族",52:"鄂伦春族",53:"赫哲族",54:"门巴族",55:"珞巴族",56:"基诺族"},T=e=>e.CardType==74?{cCardType:"港澳台居民居住证",cName:o(window.atob(e.CardInfo.Name)),cSN:e.CardInfo.SN,cNo:o(window.atob(e.CardInfo.No)),cSex:o(window.atob(e.CardInfo.Sex)),cBirthday:o(window.atob(e.CardInfo.Birthday)),cNation:o(window.atob(e.CardInfo.Nation)),cAddress:o(window.atob(e.CardInfo.Address)),cDepartment:o(window.atob(e.CardInfo.SignedDepartment)),cBegin:o(window.atob(e.CardInfo.ValidityPeriodBegin)),cEnd:o(window.atob(e.CardInfo.ValidityPeriodEnd)),cOtherNO:o(window.atob(e.CardInfo.OtherNO)),cSignNum:o(window.atob(e.CardInfo.SignNum)),PhotoDisplay:"data:image/jpg;base64,"+e.BmpInfo,cardPhotoDisplay:"data:image/jpg;base64,"+e.CardPhoto}:e.CardType==73?{cCardType:"外国人永久居留身份证(旧版)",cName:o(window.atob(e.CardInfo.Name)),cSN:e.CardInfo.SN,cNo:o(window.atob(e.CardInfo.No)),cSex:o(window.atob(e.CardInfo.Sex)),cBirthday:o(window.atob(e.CardInfo.Birthday)),cCountry:o(window.atob(e.CardInfo.Country)),cEnName:o(window.atob(e.CardInfo.EnName)),cDepartment:"中华人民共和国移民管理局",cBegin:o(window.atob(e.CardInfo.ValidityPeriodBegin)),cEnd:o(window.atob(e.CardInfo.ValidityPeriodEnd)),cVersion:o(window.atob(e.CardInfo.Version)),PhotoDisplay:"data:image/jpg;base64,"+e.BmpInfo,cardPhotoDisplay:"data:image/jpg;base64,"+e.CardPhoto}:e.CardType==89?{cCardType:"外国人永久居留身份证(新版)",cSN:e.CardInfo.SN,cName:o(window.atob(e.CardInfo.Name)),cSex:o(window.atob(e.CardInfo.Sex)),cNation:o(window.atob(e.CardInfo.Nation)),cBirthday:o(window.atob(e.CardInfo.Birthday)),cEnName:o(window.atob(e.CardInfo.EnName)),cNo:o(window.atob(e.CardInfo.No)),cDepartment:"中华人民共和国移民管理局",cBegin:o(window.atob(e.CardInfo.ValidityPeriodBegin)),cEnd:o(window.atob(e.CardInfo.ValidityPeriodEnd)),cCountry:o(window.atob(e.CardInfo.Country)),cOtherNO:o(window.atob(e.CardInfo.OtherNO)),cSignNum:o(window.atob(e.CardInfo.SignNum)),PhotoDisplay:"data:image/jpg;base64,"+e.BmpInfo,cardPhotoDisplay:"data:image/jpg;base64,"+e.CardPhoto}:{cCardType:"身份证",cName:o(window.atob(e.CardInfo.Name)),cSN:e.CardInfo.SN,cNo:o(window.atob(e.CardInfo.No)),cSex:Number(o(window.atob(e.CardInfo.Sex))),cBirthday:k(o(window.atob(e.CardInfo.Birthday))),cAge:O(o(window.atob(e.CardInfo.Birthday))),cNation:A[o(window.atob(e.CardInfo.Nation))],cAddress:o(window.atob(e.CardInfo.Address)),cDepartment:o(window.atob(e.CardInfo.SignedDepartment)),cBegin:o(window.atob(e.CardInfo.ValidityPeriodBegin)),cEnd:o(window.atob(e.CardInfo.ValidityPeriodEnd)),PhotoDisplay:"data:image/jpg;base64,"+e.BmpInfo,cardPhotoDisplay:"data:image/jpg;base64,"+e.CardPhoto},Z={Cmd:1e4,Head:"YZWL",IPFlag:"MGEyZmU1NmY5ODZlZGMyNg==",UserParam:"eyJBcHBLZXkiOiI5OWZmYjJmOThhMjkwNzExMDdjN2EwOWFkMmM2ZDA5NiIsIkRlY29kZVBob3RvIjp0cnVlLCJGYWNlQ29tcGFyZSI6ZmFsc2UsIlBob3RvRm9ybWF0IjoxLCJTZXJ2ZXJJUCI6ImlkLnl6ZnV0dXJlLmNuIiwiU2VydmVyUG9ydCI6ODg0OH0NCg==",Version:"V1.0.0"},M={__name:"index",props:{modelValue:{type:Array,default:()=>[]},level1:{type:[String,Number],default:null},level2:{type:[String,Number],default:null},level3:{type:[String,Number],default:null}},emits:["update:modelValue","update:level1","update:level2","update:level3","change"],setup(e,{emit:l}){const n=e,a=l,i=C(n.modelValue);v(async()=>{if(n.level1||n.level2||n.level3)try{n.level1&&(await r(),n.level2&&(await s(n.level1),n.level3&&await w(n.level2))),h(()=>{i.value=[n.level1||"",n.level2||"",n.level3||""].filter(d=>d!=="")})}catch(d){console.error("初始化数据失败:",d),i.value=[]}});const r=async()=>{const{data:d}=await D();return d.map(t=>({value:t.id,label:t.name}))},s=async d=>{const{data:t}=await P({building_id:d});return t.map(c=>({value:c.id,label:c.name}))},w=async d=>{const{data:t}=await p({room_id:d});return t.map(c=>({value:c.id,label:c.name}))},b={lazy:!0,lazyLoad:async(d,t)=>{const{level:c,value:f}=d;if(c>0&&!f)return t([]);try{let u=[];switch(c){case 0:u=await r();break;case 1:u=await s(f);break;case 2:u=await w(f);break;default:u=[]}u=u.map(I=>({...I,leaf:c>=2})),t(u)}catch(u){console.error("加载选项失败:",u),t([])}}},g=d=>{const t=d||[];a("update:modelValue",t),a("update:level1",t[0]||""),a("update:level2",t[1]||""),a("update:level3",t[2]||""),a("change",t)};return S(()=>n.modelValue,d=>{i.value=d||[]},{deep:!0}),(d,t)=>{const c=B("el-cascader");return V(),m(c,{style:{width:"100%"},modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=f=>i.value=f),props:b,clearable:"",placeholder:"请选择",onChange:g},null,8,["modelValue"])}}};export{Z as I,M as _,T as g,j as u};
