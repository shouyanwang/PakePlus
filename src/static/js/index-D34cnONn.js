import{s as P,q,_ as ze,d as Ge,r as i,w as He,m as Me,e as u,D as me,c as m,o as n,f as d,h as a,E as U,i as t,A as V,j as r,F as C,v as w,x as pe,t as _,C as ce,am as Ne,O as Oe,p as Re,B as Z}from"./index-BCPe6f7k.js";import{_ as Fe}from"./index.vue_vue_type_style_index_1_scoped_53aa1d82_lang-H0H1oCdf.js";import{a as Ie}from"./index-BdLHAAwy.js";import{g as Ke}from"./epartmene-CB3UALfk.js";import{a as Je,b as We}from"./scale-C5_2bO0K.js";function Xe(v={}){return P({url:"/bms/v1/task",method:"GET",params:q(v)})}function Ze(v={}){return P({url:"/bms/v1/task",method:"POST",data:q(v)})}function el(v={}){return P({url:`/bms/v1/task/${v.id}`,method:"GET",params:q(v)})}function ll(v={}){return P({url:`/bms/v1/task/${v.id}`,method:"PATCH",data:q(v)})}function al(v={}){return P({url:`/bms/v1/task/${v.id}/elder`,method:"GET",params:q(v)})}const tl={class:"task-page"},sl={class:"main"},ol={class:"search-form"},nl={class:"select-wrapper"},dl={class:"card-2"},rl={class:"left"},il={class:"tabs"},ul=["onClick"],ml={class:"search-box"},pl={class:"checkbox-group"},cl={class:"right"},_l={class:"top"},vl={class:"select"},gl={class:"count"},fl={class:"user-box hide-scrollbar"},yl=["onClick"],kl={class:"card"},bl={class:"left hide-scrollbar"},Vl=["onClick"],Cl={class:"right hide-scrollbar"},wl={class:"right-title"},hl={class:"dialog-footer"},xl={class:"task-list hide-scrollbar"},Al={class:"flex-between"},Tl={class:"button-group"},Sl={class:"qrcode-wrap"},Ul=["src"],El={__name:"index",setup(v){const{proxy:A}=Ge(),p=i({name:"",admin_name:"",start_time:"",end_time:"",page:1,per_page:10}),z=i(!1),ee=i(0),le=i([]),E=async()=>{z.value=!0;let s,e;p.value.start_time&&(s=p.value.start_time[0],e=p.value.start_time[1]);const y=await Xe({...p.value,start_time:s,end_time:e});z.value=!1,le.value=y.data.data,ee.value=y.data.total};E();const _e=()=>{p.value.page=1,E()},h=i(!1),G=i(""),o=i({name:"",scale_ids:[],start_time:[],elder_ids:[]}),ve={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],start_time:[{required:!0,message:"请选择开始日期",trigger:"change"}],elder_ids:[{required:!0,message:"请选择长者",trigger:"change"}],scale_ids:[{required:!0,message:"请选择评估内容",trigger:"change"}]};i([]);const x=i({keyword:"",epartmene_id:"",status:1,page:1,per_page:1e3}),T=i([]),H=i(!1),ge=s=>{s?o.value.elder_ids=T.value.map(e=>e.id):o.value.elder_ids=[]};He(()=>o.value.elder_ids,s=>{H.value=T.value.length>0&&s.length===T.value.length},{deep:!0});const $=async()=>{const s=await Ie(x.value);T.value=s.data.data},fe=()=>{o.value.elder_ids=[]},ye=(s,e)=>{o.value.elder_ids.splice(e,1)},ae=i([]),te=async()=>{const s=await Ke();ae.value=s.data},ke=i([{name:"已入住",value:1},{name:"未入住",value:0}]),be=(s,e)=>{x.value.status=s.value,$()},M=()=>{o.value.id="",Object.keys(o.value).forEach(s=>{o.value[s]=""}),o.value.elder_ids=[],o.value.scale_ids=[],S.value.category_id=0,S.value.keyword="",A.resetForm("formRef")},Ve=async()=>{await M(),await $(),await te(),h.value=!0,G.value="添加任务"},Ce=i(!0),L=i([]);(async()=>{const s=await Je({all:2});L.value=s.data,L.value.unshift({id:0,name:"全部"})})();const N=i(""),we=(s,e)=>{N.value=s.id,S.value.category_id=s.id,R()},he=Me(()=>{const s=L.value.findIndex(e=>e.id==N.value);return s===-1?{}:{top:`${s*50+46}px`}}),O=i([]),S=i({keyword:"",category_id:"0"}),R=async()=>{const s=await We(S.value);O.value=s.data};R();const xe=async s=>{M();const e=await el({id:s.id});o.value.id=s.id,o.value.name=e.data.name,o.value.elder_ids=e.data.elder.map(y=>y.elder_id),o.value.scale_ids=e.data.scale_one.map(y=>y.scale_id),o.value.start_time=[e.data.start_time,e.data.end_time],await $(),await te(),h.value=!0,G.value="修改任务"},Ae=()=>{h.value=!1,M()},Te=()=>{A.$refs.formRef.validate(async s=>{s&&(o.value.id!=""?(await ll({id:o.value.id,name:o.value.name,elder_ids:o.value.elder_ids.join(","),scale_ids:o.value.scale_ids.join(","),start_time:o.value.start_time[0],end_time:o.value.start_time[1]}),A.$modal.msgSuccess("修改成功"),h.value=!1,E()):(await Ze({name:o.value.name,elder_ids:o.value.elder_ids.join(","),scale_ids:o.value.scale_ids.join(","),start_time:o.value.start_time[0],end_time:o.value.start_time[1]}),A.$modal.msgSuccess("新增成功"),h.value=!1,E()))})},F=i(!1),se=i([]),oe=i(0),j=i({page:1,per_page:10}),ne=async s=>{const e=await al({id:s.id});se.value=e.data.data,oe.value=e.data.total},Se=async s=>{await ne(s),F.value=!0},I=i(!1),Y=i(""),Ue=s=>{I.value=!0,Y.value=s.qr_code},Ee=async s=>{try{await navigator.clipboard.writeText(s),A.$modal.msgSuccess("复制成功")}catch{A.$modal.msgError("复制失败")}},$e=async s=>{};return(s,e)=>{const y=u("el-input"),g=u("el-form-item"),b=u("el-col"),de=u("el-date-picker"),D=u("el-row"),f=u("el-button"),K=u("el-form"),De=u("el-option"),Pe=u("el-select"),J=u("el-checkbox"),re=u("el-checkbox-group"),qe=u("el-tooltip"),Le=u("el-divider"),je=u("el-empty"),W=u("Dialog"),ie=u("svg-icon"),Ye=u("el-text"),B=u("el-table-column"),Be=u("el-table"),ue=u("Pagination"),Q=me("hasPermi"),Qe=me("loading");return n(),m("div",tl,[d("div",sl,[d("div",ol,[a(K,{model:p.value,ref:"queryRef","label-position":"top"},{default:t(()=>[a(D,{gutter:47},{default:t(()=>[a(b,{span:6},{default:t(()=>[a(g,{label:"计划名字",prop:"name"},{default:t(()=>[a(y,{modelValue:p.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>p.value.name=l),placeholder:"请输入计划名字",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:t(()=>[a(g,{label:"创建人员",prop:"admin_name"},{default:t(()=>[a(y,{modelValue:p.value.admin_name,"onUpdate:modelValue":e[1]||(e[1]=l=>p.value.admin_name=l),placeholder:"请输入创建人员名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:12},{default:t(()=>[a(g,{label:"计划开始/结束时间"},{default:t(()=>[a(de,{modelValue:p.value.start_time,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value.start_time=l),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"请选择开始日期","end-placeholder":"请选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(g,null,{default:t(()=>[U((n(),V(f,{type:"primary",icon:"Search",onClick:_e},{default:t(()=>e[20]||(e[20]=[r("查询")])),_:1,__:[20]})),[[Q,["GET.task"]]]),U((n(),V(f,{icon:"plus",type:"primary",plain:"",onClick:Ve},{default:t(()=>e[21]||(e[21]=[r("新增任务")])),_:1,__:[21]})),[[Q,["POST.task"]]])]),_:1})]),_:1},8,["model"])]),a(W,{modelValue:h.value,"onUpdate:modelValue":e[12]||(e[12]=l=>h.value=l),title:G.value,width:"1268"},{footer:t(()=>[d("div",hl,[a(f,{onClick:Ae},{default:t(()=>e[24]||(e[24]=[r("取消")])),_:1,__:[24]}),a(f,{type:"primary",onClick:Te},{default:t(()=>e[25]||(e[25]=[r(" 确认 ")])),_:1,__:[25]})])]),default:t(()=>[a(K,{model:o.value,rules:ve,ref:"formRef","label-width":"90","label-position":"left"},{default:t(()=>[a(D,{gutter:150},{default:t(()=>[a(b,{span:12},{default:t(()=>[a(g,{label:"任务名称",prop:"name"},{default:t(()=>[a(y,{modelValue:o.value.name,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.name=l),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:12},{default:t(()=>[a(g,{label:"选择日期",prop:"start_time"},{default:t(()=>[a(de,{modelValue:o.value.start_time,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.start_time=l),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(g,{label:"长者姓名",prop:"elder_ids"},{default:t(()=>[d("div",nl,[U(d("div",dl,[d("div",rl,[d("div",il,[(n(!0),m(C,null,w(ke.value,(l,k)=>(n(),m("div",{class:pe(["tab-item",{active:x.value.status===l.value}]),key:k,onClick:c=>be(l,k)},_(l.name),11,ul))),128))]),d("div",ml,[a(Pe,{class:"search-select",modelValue:x.value.epartmene_id,"onUpdate:modelValue":e[5]||(e[5]=l=>x.value.epartmene_id=l),placeholder:"请选择所属科室",clearable:"",onChange:$},{default:t(()=>[(n(!0),m(C,null,w(ae.value,l=>(n(),V(De,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(y,{modelValue:x.value.keyword,"onUpdate:modelValue":e[6]||(e[6]=l=>x.value.keyword=l),placeholder:"搜索长者姓名","suffix-icon":"search",clearable:"",onKeydown:ce($,["enter"])},null,8,["modelValue"]),a(J,{modelValue:H.value,"onUpdate:modelValue":e[7]||(e[7]=l=>H.value=l),label:"全选",size:"large",onChange:ge},null,8,["modelValue"]),d("div",pl,[a(re,{modelValue:o.value.elder_ids,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.elder_ids=l)},{default:t(()=>[(n(!0),m(C,null,w(T.value,l=>(n(),V(J,{key:l.id,label:l.name+" "+l.phone,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),d("div",cl,[d("div",_l,[d("div",vl,[e[22]||(e[22]=r(" 已选择")),d("span",gl,_(o.value.elder_ids.length),1),e[23]||(e[23]=r("人 "))]),d("div",{class:"clear",onClick:e[9]||(e[9]=l=>fe())}," 清空 ")]),d("div",fl,[(n(!0),m(C,null,w(o.value.elder_ids,(l,k)=>(n(),m("div",{class:"user-item",key:k},[r(_(T.value.find(c=>c.id==l).name)+" ",1),d("img",{class:"close",src:Fe,alt:"",onClick:c=>ye(l,k)},null,8,yl)]))),128))])])],512),[[Ne,Ce.value]])])]),_:1}),a(g,{label:"评估项目",prop:"scale_ids"},{default:t(()=>[d("div",kl,[d("div",bl,[(n(!0),m(C,null,w(L.value,(l,k)=>(n(),m("div",{class:pe(["item",{"active-item":N.value===l.id}]),key:k,onClick:c=>we(l,k)},[a(qe,{effect:"dark",content:l.name,placement:"right"},{default:t(()=>[r(_(l.name),1)]),_:2},1032,["content"])],10,Vl))),128)),d("div",{class:"active-indicator",style:Oe(Re(he))},null,4)]),d("div",Cl,[a(y,{modelValue:S.value.keyword,"onUpdate:modelValue":e[10]||(e[10]=l=>S.value.keyword=l),class:"search",placeholder:"支持缩写、中文名称、关键词等搜索","suffix-icon":"search",onKeydown:ce(R,["enter"])},null,8,["modelValue"]),O.value.length>0?(n(!0),m(C,{key:0},w(O.value,(l,k)=>(n(),m("div",{key:k},[d("div",wl,_(l.name),1),a(re,{modelValue:o.value.scale_ids,"onUpdate:modelValue":e[11]||(e[11]=c=>o.value.scale_ids=c)},{default:t(()=>[(n(!0),m(C,null,w(l.scale,(c,X)=>(n(),V(J,{key:X,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue"]),a(Le)]))),128)):(n(),V(je,{key:1,description:"暂无数据","image-size":150}))])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),U((n(),m("div",xl,[(n(!0),m(C,null,w(le.value,(l,k)=>(n(),m("div",{class:"task-item",key:k},[a(K,null,{default:t(()=>[a(D,{gutter:47},{default:t(()=>[a(b,{span:5},{default:t(()=>[a(g,{label:"计划名字"},{default:t(()=>[r(_(l.name),1)]),_:2},1024)]),_:2},1024),a(b,{span:5},{default:t(()=>[a(g,{label:"创建人员"},{default:t(()=>[r(_(l.admin.name),1)]),_:2},1024)]),_:2},1024),a(b,{span:5}),a(b,{span:9},{default:t(()=>[a(g,{label:"创建时间"},{default:t(()=>[d("div",Al,[d("div",null,_(l.created_at),1),l.status==1?(n(),V(f,{key:0,type:"primary",round:""},{default:t(()=>e[26]||(e[26]=[r(" 待完成 ")])),_:1,__:[26]})):Z("",!0),l.status==2?(n(),V(f,{key:1,type:"success",round:""},{default:t(()=>e[27]||(e[27]=[r(" 已完成 ")])),_:1,__:[27]})):Z("",!0),l.status==3?(n(),V(f,{key:2,type:"info",round:""},{default:t(()=>e[28]||(e[28]=[r(" 已取消 ")])),_:1,__:[28]})):Z("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(D,null,{default:t(()=>[a(b,{span:24},{default:t(()=>[a(g,{label:"评估内容"},{default:t(()=>[(n(!0),m(C,null,w(l.scale,(c,X)=>(n(),m("span",{key:X},_(c.name)+"、",1))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),a(D,null,{default:t(()=>[a(b,{span:24},{default:t(()=>[a(g,{label:"计划开始/结束时间"},{default:t(()=>[r(_(l.start_time)+" ~ "+_(l.end_time),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),d("div",Tl,[a(f,{type:"primary",plain:"",onClick:c=>Se(l)},{default:t(()=>e[29]||(e[29]=[r(" 评估人员 ")])),_:2,__:[29]},1032,["onClick"]),a(f,{type:"primary"},{default:t(()=>[e[30]||(e[30]=r(" 一键提醒 ")),a(ie,{"icon-class":"remind",class:"icon-svg"})]),_:1}),a(f,{type:"primary",plain:"",onClick:c=>Ue(l)},{default:t(()=>e[31]||(e[31]=[r(" 生成二维码 ")])),_:2,__:[31]},1032,["onClick"]),U((n(),V(f,{type:"primary",plain:"",onClick:c=>xe(l)},{default:t(()=>e[32]||(e[32]=[r(" 修改 ")])),_:2,__:[32]},1032,["onClick"])),[[Q,["PATCH.task/{task}"]]]),U((n(),V(f,{type:"primary",plain:"",onClick:c=>$e(l)},{default:t(()=>e[33]||(e[33]=[r(" 取消 ")])),_:2,__:[33]},1032,["onClick"])),[[Q,["DELETE.task/{task}"]]])])]),_:2},1024)]))),128)),a(W,{modelValue:I.value,"onUpdate:modelValue":e[14]||(e[14]=l=>I.value=l),width:"972",header:!1},{default:t(()=>[d("div",Sl,[d("img",{class:"img",src:Y.value,alt:""},null,8,Ul),d("div",null,[r(_(Y.value)+" ",1),a(Ye,{type:"primary",class:"copy-text",onClick:e[13]||(e[13]=l=>Ee(Y.value))},{default:t(()=>e[34]||(e[34]=[r("复制链接")])),_:1,__:[34]})])])]),_:1},8,["modelValue"]),a(W,{modelValue:F.value,"onUpdate:modelValue":e[17]||(e[17]=l=>F.value=l),width:"909",title:"评估人员",footer:!1},{default:t(()=>[a(Be,{data:se.value,"max-height":"522"},{default:t(()=>[a(B,{prop:"elder",label:"姓名",align:"center"},{default:t(({row:l})=>[r(_(l.elder.name),1)]),_:1}),a(B,{prop:"phone",label:"手机号",align:"center"},{default:t(({row:l})=>[r(_(l.elder.phone),1)]),_:1}),a(B,{prop:"completion",label:"是否完成",align:"center"},{default:t(({row:l})=>[r(_(l.completion==1?"已完成":"未完成"),1)]),_:1}),a(B,{prop:"action",label:"操作",width:"120",align:"center"},{default:t(()=>[a(f,{type:"primary"},{default:t(()=>[e[35]||(e[35]=r(" 提醒 ")),a(ie,{"icon-class":"remind",class:"icon-svg"})]),_:1})]),_:1})]),_:1},8,["data"]),a(ue,{total:oe.value,layout:"total, prev, pager, next, jumper",page:j.value.page,"onUpdate:page":e[15]||(e[15]=l=>j.value.page=l),limit:j.value.per_page,"onUpdate:limit":e[16]||(e[16]=l=>j.value.per_page=l),onPagination:ne},null,8,["total","page","limit"])]),_:1},8,["modelValue"])])),[[Qe,z.value]]),a(ue,{class:"pagination",total:ee.value,layout:"total, prev, pager, next, jumper",page:p.value.page,"onUpdate:page":e[18]||(e[18]=l=>p.value.page=l),limit:p.value.per_page,"onUpdate:limit":e[19]||(e[19]=l=>p.value.per_page=l),onPagination:E},null,8,["total","page","limit"])])])}}},Yl=ze(El,[["__scopeId","data-v-66345941"]]);export{Yl as default};
